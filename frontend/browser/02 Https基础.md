# 二、HTTPS

## 1.什么是 HTTPS 协议

超文本传输安全协议是一种通过计算机网络进行安全通讯的传输协议，HTTPS 经由 HTTP 进行通讯，利用 SSL/TLS 来加密数据包。HTTPS 的主要目的是提供对网站服务器的身份认证，保护交换数据的隐私与完整性。

HTTP 协议采用明文传输信息，存在信息窃听、信息篡改和信息劫持的风险，而协议 TLS/SSL 具有身份认证、信息加密和完整性校验的功能，可以避免此类问题的发生。

安全层的主要职责就是对发起的 HTTP 请求的数据进行加密操作和对接收到的 HTTP 的内容进行解密。

## 2.TLS/SSL 的工作原理

TLS 全称**安全传输层协议**以及前身 SSL**安全套接层**，是介于 TCP 和 HTTP 之间的一层安全协议，不影响原有的 TCP 和 HTTP 协议，所以使用 HTTPS 基本上不需要对 HTTP 页面进行太多改造。

TLS/SSL 的功能实现主要依赖三类基本算法：

- 散列函数 hash：用来验证信息的完整性
- 对称加密算法：采用协商的密钥对数据加密
- 非对称加密：实现身份认证和密钥协商

## 3.对称加密和非对称加密

对称加密和非对称加密都是安全传输层里的加密算法。

**对称加密**

简介：

对称加密的特点是文件加密和解密使用相同的密钥，即加密密钥也可以用作解密密钥。这种方法在密码学中叫做对称加密算法，对称加密算法使用起来简单快捷，密钥较短，且破译困难。通信双方都使用同一个密钥进行加密，解密。

优点：

计算量小，加密速度快，加密效率高。

缺点：

在数据传输前，发送方和接收方必须商定好密钥，然后双方保存好密钥。如果一方的密钥被泄露，那么加密的信息就不安全了。最不安全的地方就是在与第一次开始，互相约定密钥进行密钥传输的时候。

**非对称加密**

简介：

通讯双方时使用不同的密钥进行加密和解密，即密钥对。私钥可以解密公钥加密的内容，公钥可以解密私钥加密的内容。公开公钥，别人使用公钥加密数据传送，收到数据后再使用私钥解密。

优点：

安全性比对称加密要好。

缺点：

加密和解密时间长、速度慢、只适合少量数据进行加密。

## 4.数字证书

简介：

使用一种 Hash 算法对公钥和其他信息进行加密，生成一个信息摘要，然后让有公信力的认证中心（CA）用它的私钥对信息摘要加密，形成签名（数字签名）。然后将原始的信息和签名合在一起，称为数字证书。当接收方收到数字证书的时候，先根据原始信息使用同样的 Hash 算法生成一个摘要，然后使用公证处的公钥来对数字证书中的摘要进行解密，最后将解密的摘要和生成的摘要进行对比，就可以发现得到的信息是否被更改了。

作用：

当存在一个中间人，截取了对方发给我们的公钥，然后把他自己的公钥发送给我们，当我们使用他的公钥进行加密发送后，他就可以使用他的私钥对信息解密，并且使用之前的公钥加密后发送信息。这样我们的信息就被窃取了并且无法知道。

## 5.HTTPS 握手过程

1. 客户端向服务器发送请求，请求中包含使用的协议号版本、生成的随机数、客户端支持的加密方法
2. 服务器收到请求后，确认双方使用的加密方法，给出服务器的证书以及一个服务器生成的随机数。
3. 客户端确认服务器证书有效性后，生成一个新的随机数，并使用数字证书中的公钥加密这个随机数，然后发送给服务器。并且还会提供一个前面所有内容的 hash 值，用来给服务器校验。
4. 服务器使用自己的私钥解密客户端发来的随机数。并提供前面所有内容的 hash 值给客户端检验。
5. 客户端和饥饿服务端更具约定的加密方法，使用前面三个随机数生成密钥，以后所有对话过程都是用这个密钥来加密信息。

## 6.HTTPS 的优缺点

**优点**

- 使用 HTTPS 协议可以认证用户和服务器，确保数据发送到正确的客户端和服务器。
- 使用 HTTPS 协议可以进行加密传输、身份认证，通讯更安全，防止数据在传输过程中被篡改、窃取，确保数据的安全性。
- HTTPS 是先行框架下最安全的解决方案，虽然不是绝对安全，但是大幅增加中间人攻击成本。

**缺点**

- HTTPS 需要做服务器和客户端双方都加密和解密过程，耗费更多的服务器资源，过程复杂。
- HTTPS 戏小姨或首阶段比较费时，增加页面加载事件。
- SSL 证书是收费的，功能越强大的证书费用越高。
- HTTPS 链接服务器端资源占用高很多，支持方可稍多的网站需要投入更大的成本。
- SSL 证书需要绑定 IP，不能在同一个 IP 上绑定多个域名。

## 7.HTTPS 如何保证安全的

结合对称加密和非对称加密两种方式，将对称加密的密钥使用非对称加密的公钥进行加密，然后发送出去，接收方使用私钥进行解密得到堆成加密的密钥，然后双方使用对称加密来通讯。这个时候需要一个第三方颁发证书（CA），证明身份，防止被中间人攻击。

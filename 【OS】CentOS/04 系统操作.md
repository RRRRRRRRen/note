# 关机与重启

> `shutdown` 命令是 Linux 系统中用于关机和重启计算机的主要命令之一。它允许你在指定的时间内关闭系统，或者在系统关闭之前发送通知给所有用户。你可以使用它来安排计划性关机、重启，或者立即关机。

## 基本语法

```bash
sudo shutdown [选项] [时间] [消息]
```

- **`[选项]`**：提供控制关机行为的选项。
- **`[时间]`**：指定关机的时间，支持多个格式。
- **`[消息]`**：一个自定义的消息，可以在关机前广播给所有登录的用户。

### 1. 选项参数

#### **`-h`**：关机

- **`-h`** 选项表示关机（halt），系统将关闭所有服务并关闭电源（或者进入关机状态）。

    ```bash
    sudo shutdown -h now # 这个命令会立即关闭系统。
    ```

#### **`-r`**：重启

- **`-r`** 选项表示重启系统（reboot），系统在关机后会自动重启。

    ```bash
    sudo shutdown -r now # 这个命令会立即重启系统。
    ```

#### **`-c`**：取消关机

- **`-c`** 选项表示取消正在进行的关机操作。如果你设置了一个关机计划，但决定取消它，可以使用这个选项。

    ```bash
    sudo shutdown -c # 这个命令会取消当前正在等待或计划的关机操作。
    ```

### 2. 时间参数

#### **`now`**：立即执行

- **`now`** 表示立即执行关机或重启操作。

    ```bash
    sudo shutdown -h now  # 立即关机
    sudo shutdown -r now  # 立即重启
    ```

#### **`+m`**：延迟数分钟执行

- 你可以在 `+m` 后面指定多少分钟后执行关机或重启。例如，`+10` 表示在 10 分钟后执行关机或重启。

    ```bash
    sudo shutdown -h +10  # 10 分钟后关机
    sudo shutdown -r +15  # 15 分钟后重启
    ```

#### **`hh:mm`**：指定时间执行

- 你可以指定具体的关机时间，格式为 `hh:mm`，即小时和分钟的格式，表示在某个具体时间点执行关机或重启操作。例如，`23:30` 表示在晚上 11:30 执行关机或重启。

    ```bash
    sudo shutdown -h 23:30  # 在晚上 11:30 关机
    sudo shutdown -r 06:00  # 在早上 6:00 重启
    ```

### 3. **消息参数**

- 你可以通过 `shutdown` 命令广播一条消息给所有正在登录的用户，告知他们系统将关机或重启。

```bash
# 这条命令会在 10 分钟后关机，同时向所有登录用户发送提示：“系统将在 10 分钟后关闭，请保存您的工作！”
sudo shutdown -h +10 "系统将在 10 分钟后关闭，请保存您的工作！"
```

## 取消关机重启计划

如果你已经设置了一个计划的关机时间，可以使用 `shutdown` 命令的 `-c` 选项来查看或取消它。

```bash
sudo shutdown -c  # 取消当前计划的关机
```

---

# 切换用户

> `su` 命令（**substitute user** 或 **switch user**）是 Linux 系统中用于切换用户身份的命令。它允许当前用户临时切换到其他用户的身份，默认情况下是切换到 `root` 用户。`su` 是一种非常常用的命令，尤其在系统管理和需要提升权限时。

## 1. 基本语法

```bash
su [选项] [用户名]
```

- **`用户名`**：目标用户的用户名，如果不指定，默认是 `root` 用户。
- **`选项`**：用于控制 `su` 命令的行为，例如是否模拟目标用户的环境等。

## 2. **常用选项**

### **`-` 或 `--login`**

- 当你使用 `su -` 或 `su --login` 时，它会模拟完全的登录过程，切换到目标用户并加载该用户的环境配置文件（如 `.bash_profile` 或 `.bashrc`），确保目标用户的环境变量、路径等与登录时的一致。

    ```bash
    su - username  # 切换到指定用户并加载该用户的环境
    su -           # 切换到 root 用户并加载 root 用户的环境
    ```

### **`-c`**

- `-c` 选项允许你在目标用户的环境中执行一条命令，而不是启动一个交互式的 shell 会话。你提供的命令会作为目标用户的命令执行，执行完后会返回到原来的用户会话。

    ```bash
    su -c "ls /root"  # 以 root 用户身份执行 "ls /root" 命令
    ```

## 3. `su` 与 `sudo` 的区别

|**功能**|**`su`**|**`sudo`**|
|---|---|---|
|**切换用户**|切换到目标用户的 shell，会要求输入目标用户的密码|执行指定用户（通常是 root）的命令，会要求输入当前用户的密码|
|**安全性**|需要全程使用目标用户的密码，容易产生安全隐患|通过配置权限和记录日志，通常更安全|
|**环境切换**|需要使用 `su -` 来加载目标用户的环境|自动加载目标用户的环境|
|**日志记录**|无自动日志记录|可以记录执行的每个命令，便于审计|

# 注销登录

`logout` 命令是用来退出当前的登录会话，特别适用于在命令行环境下退出一个 shell 会话。这个命令通常在交互式的 shell 会话中使用，例如当你通过终端登录系统后，如果希望结束当前的会话，可以使用 `logout` 命令。

## 1. 基本用途

用于 **退出当前会话**，当你完成工作后，输入 `logout` 会退出当前的 shell 会话，并返回到登录提示符。具体的行为可能因你使用的 shell 类型、登录方式和系统设置不同而有所不同。

## 2. 与 `exit` 命令的关系

- `logout` 和 `exit` 这两个命令在大多数情况下具有相同的作用，都是用来退出当前的 shell 会话。
- 然而，`exit` 更通用，适用于所有类型的 shell 会话，而 `logout` 主要用于登录 shell（登录后创建的 shell）。

```bash
exit   # 退出 shell
logout # 退出登录 shell
```

# 退出会话

> `exit` 命令是用来退出当前 shell 会话的命令，它适用于所有类型的 shell 会话。无论你是在本地终端、远程 SSH 会话、还是在脚本中使用，`exit` 都能终止当前 shell 的执行，并返回到调用该 shell 的上一层环境。

## 1. 基本语法

```bash
exit [n]
```

- **`n`**：可选参数，表示退出的状态码（通常是一个整数）。默认情况下，`exit` 返回的是 shell 的退出状态码，如果不指定，默认返回当前 shell 的状态。

## 2. **常见用途**

### 2.1 **退出当前 shell 会话**

- `exit` 命令最常见的用途是退出当前的 shell 会话，无论是在本地终端，还是远程 SSH 会话中。

    ```bash
    exit
    ```

### 2.2 **退出并返回特定的状态码**

- `exit` 命令可以接收一个数字作为参数，表示 shell 的退出状态码。通常，`0` 表示正常退出，非 `0` 表示错误或异常退出。

    ```bash
    exit 0   # 正常退出，表示没有错误
    exit 1   # 非正常退出，通常表示某些错误发生
    ```

### 2.3 **退出嵌套的 shell 会话**

- 如果你在一个 shell 会话中嵌套了另一个 shell，执行 `exit` 命令将退出最内部的 shell，并返回到外部 shell 会话，直到所有嵌套的 shell 都退出。

    ```bash
    bash   # 启动一个新的 shell 会话
    exit    # 退出内层 shell 会话，返回到外层 shell 会话
    ```

### 2.4 **退出并结束脚本执行**

- 在编写脚本时，`exit` 命令可以用来结束脚本的执行并返回特定的退出状态。比如，如果脚本运行成功，可以返回 `exit 0`，如果遇到错误，则返回非 `0` 的状态码。

    ```bash
    #!/bin/bash
    echo "开始执行脚本"
    
    # 如果发生错误，退出脚本并返回错误码
    if [ ! -f "/some/file" ]; then
      echo "文件不存在！"
      exit 1  # 返回非零状态，表示错误
    fi
    
    echo "脚本执行完成"
    exit 0  # 正常退出，表示成功
    ```

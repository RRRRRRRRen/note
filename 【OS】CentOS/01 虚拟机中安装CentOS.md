# 开启虚拟化设置

> 要在计算机的 **BIOS/UEFI** 中开启 **虚拟化技术（VT-x/AMD-V）**，以便在 VMware、VirtualBox 或 KVM 等虚拟化软件中运行虚拟机，可以按照以下步骤操作：

## 1. 确认 CPU 是否支持虚拟化

在进入 BIOS 之前，先检查你的 CPU 是否支持硬件虚拟化：

### Windows 用户

- 按 **`Win + R`**，输入 **`cmd`** 打开命令提示符，运行：

  ```cmd
  systeminfo | find "虚拟化"
  ```

  - 如果显示 **“已启用”**，说明虚拟化已开启。
  - 如果显示 **“未启用”**，需要进入 BIOS 设置。

### Linux 用户

- 在终端运行：

  ```sh
  egrep -c '(vmx|svm)' /proc/cpuinfo
  ```

  - 如果输出 **≥1**，说明 CPU 支持虚拟化（`vmx` 是 Intel VT-x，`svm` 是 AMD-V）。
  - 如果输出 **0**，可能是 BIOS 未开启虚拟化，或者 CPU 不支持。

### Mac 用户

- 默认已经开启虚拟化，且无法更改

## 2. 进入 BIOS/UEFI 设置

不同品牌的主板/笔记本进入 BIOS 的方式不同，一般方法：

1. **重启电脑**。
2. 在开机自检（POST）时，按 **特定按键**（通常是 `F2`、`F10`、`Del`、`Esc` 或 `F12`）进入 BIOS。
   - **常见品牌按键**：
     - **ASUS（华硕）**：`F2` 或 `Del`
     - **Dell（戴尔）**：`F2` 或 `F12`
     - **HP（惠普）**：`F10` 或 `Esc`
     - **Lenovo（联想）**：`F2` 或 `Fn + F2`
     - **MSI（微星）**：`Del`
     - **Acer（宏碁）**：`F2` 或 `Del`
   - 如果不确定，可以尝试多次按 `F2` 或 `Del`。

## 3. 找到虚拟化选项并启用

BIOS 界面因厂商不同而有所差异，但一般虚拟化选项位于：

- **Intel CPU**：`Intel Virtualization Technology (VT-x)` 或 `Intel VT-d`
- **AMD CPU**：`SVM Mode` 或 `AMD-V`

## **4. 保存并退出 BIOS**

1. 按 **`F10`**（或选择 `Save & Exit`）保存设置。
2. 确认 **Yes**，电脑会自动重启。

---

# 安装 VMware

## 1. 下载 VMware Fusion

- 官网下载：[https://www.vmware.com/products/fusion.html](https://www.vmware.com/products/fusion.html)
  - **Apple Silicon（M 1/M 2/M 3）**：选择 **Fusion 13+**（原生支持 ARM）。
  - **Intel Mac**：选择 **Fusion 12+**。

## 2. 安装 VMware Fusion

1. 双击下载的 **`.dmg`** 文件，拖动 `VMware Fusion` 到 `Applications` 文件夹。
2. 打开 **Launchpad** 或 **Applications**，启动 **VMware Fusion**。
3. 首次运行会提示 **“是否允许系统扩展”**，点击 **“打开安全性与隐私”** → **“允许”**。
4. 输入 **管理员密码** 完成安装。

# 下载 CentOS 镜像

> 在 macOS 上安装 CentOS 虚拟机时，选择合适的 **CentOS 镜像** 非常重要，特别是区分 **Intel (x 86_64)** 和 **Apple Silicon (ARM/aarch 64)** 架构。以下是详细指南：

## 1. 官方 CentOS 镜像下载

推荐在 [阿里巴巴开源镜像站](https://developer.aliyun.com/mirror/) 下载

## 2. 注意

- **Intel Mac** → 下载 `x86_64` 镜像
- **Apple Silicon** → 必须选 `aarch64` 镜像。

# VMware 网络配置

> 在 VMware（如 VMware Fusion、Workstation 或 ESXi）中，虚拟机的网络配置决定了它如何与主机、其他虚拟机及外部网络通信。以下是 **VMware 网络模式的详细解析**，涵盖 **桥接、NAT、仅主机** 等模式的区别、适用场景及配置方法。

## 1. VMware 的主要网络模式

| **模式**       | **虚拟机 IP**       | **能否访问外网** | **能否被局域网访问** | **适用场景**               |
|----------------|--------------------|----------------|---------------------|--------------------------|
| **桥接 (Bridged)**       | 与主机同网段的独立 IP | ✔️             | ✔️                  | 虚拟机需作为独立设备（如服务器） |
| **NAT**                 | 主机分配的私有 IP     | ✔️             | ❌（需端口转发）      | 默认模式，安全上网          |
| **仅主机 (Host-Only)**   | 主机分配的私有 IP     | ❌             | ❌（仅主机可见）      | 隔离测试、内部开发环境       |
| **自定义 (LAN Segment)** | 用户自定义           | 取决于配置      | 取决于配置           | 复杂多虚拟机隔离网络        |

## 2. 各模式详解与配置

### (1) 桥接模式 (Bridged)

- **原理**：虚拟机通过主机物理网卡直接接入 **局域网**，就像一台真实设备。
- **IP 分配**：由局域网 DHCP 分配（或手动设置），与主机在同一网段（如 `192.168.1.x`）。
- **优点**：
  - 虚拟机可被局域网其他设备访问（如运行 Web 服务器）。
  - 直接使用物理网络带宽。
- **缺点**：
  - 可能占用局域网 IP 资源。
  - 需配置防火墙规则允许外部访问。
- **配置步骤**：
  1. 在 VMware 中选择虚拟机 → **设置** → **网络适配器**。
  2. 选择 **“桥接模式”**，并指定物理网卡（有线/Wi-Fi）。
  3. 在虚拟机中配置 IP（DHCP 或手动）。

### (2) NAT 模式（默认模式）

- **原理**：虚拟机通过主机的 **NAT 服务** 共享主机的 IP 上网，主机充当路由器。
- **IP 分配**：由 VMware 虚拟 DHCP 服务分配（如 `192.168.xx.xx`）。
- **优点**：
  - 虚拟机可访问外网，但外部无法直接访问虚拟机（安全）。
  - 不占用局域网 IP。
- **缺点**：
  - 如需从外部访问虚拟机，需配置 **端口转发**（见下文）。
- **配置步骤**：
  1. 选择 **“NAT 模式”**。
  2. 虚拟机自动获取 IP（或手动设置与 NAT 同网段）。
  3. （可选）配置端口转发：
     - 在 VMware 的 **编辑** → **虚拟网络编辑器** 中，选择 NAT 设备 → **端口转发**。

### (3) 仅主机模式 (Host-Only)

- **原理**：虚拟机与主机通过 **私有虚拟网络** 通信，完全隔离于外部网络。
- **IP 分配**：由 VMware 虚拟 DHCP 分配（如 `192.168.xx.xx`）。
- **优点**：
  - 绝对安全，适合测试敏感服务（如病毒分析）。
  - 主机和虚拟机可互相访问。
- **缺点**：
  - 虚拟机无法访问互联网。
- **配置步骤**：
  1. 选择 **“仅主机模式”**。
  2. 主机和虚拟机需在同一子网（如主机 `192.168.56.1`，虚拟机 `192.168.56.2`）。

### (4) 自定义 (LAN Segment)

- **原理**：用户自定义虚拟网络，用于多虚拟机之间的隔离通信。
- **适用场景**：
  - 模拟复杂网络拓扑（如攻防演练）。
  - 多个虚拟机需隔离组网（如 Kubernetes 集群）。
- **配置步骤**：
  1. 在 **虚拟网络编辑器** 中创建新的 LAN Segment。
  2. 为多个虚拟机分配同一 LAN Segment。

## 3. 高级网络功能

### **(1) 端口转发（NAT 模式适用）**

将主机的某个端口映射到虚拟机的端口，实现外部访问：

- **示例**：将主机的 `8080` 转发到虚拟机的 `80`（Web 服务）。
- **配置方法**：
  1. 打开 **虚拟网络编辑器** → 选择 NAT 设备 → **端口转发**。
  2. 添加规则：主机端口 `8080` → 虚拟机 IP `192.168.xx.xx:80`。

### (2) 静态 IP 设置

避免 DHCP 分配变动：

- **Linux（如 CentOS）**：

  ```sh
  nmtui  # 图形化工具设置静态 IP
  ```

  或手动编辑 `/etc/sysconfig/network-scripts/ifcfg-ens33`（CentOS 7）。

- **Windows**：
  通过 `控制面板` → `网络和共享中心` → `适配器设置` 修改 IPv 4。

### (3) 多网卡混合模式

为虚拟机配置多个网络适配器，例如：

- **网卡 1**：NAT（上网）。
- **网卡 2**：仅主机（与主机通信）。

## 4. 常见问题

### Q 1: 虚拟机无法上网？

- 检查网络模式是否为 **NAT 或桥接**。
- 在虚拟机中运行：

  ```sh
  ping 8.8.8.8      # 测试外网连通性
  ip a              # 检查 IP 是否分配
  systemctl restart NetworkManager  # 重启网络服务（Linux）
  ```

### Q 2: 如何让局域网访问我的虚拟机？

- 使用 **桥接模式**，并确保虚拟机 IP 与局域网同网段。
- 或配置 **NAT 端口转发**（如转发主机的 80 端口到虚拟机）。

### Q 3: 主机和虚拟机如何共享文件？

- **VMware Tools**：启用文件夹共享（需安装增强工具）。
- **SSH/SFTP**：通过 IP 直接传输文件。

## 5. 总结

| **需求**     | **推荐模式**        | **配置要点**          |
| ---------- | --------------- | ----------------- |
| 虚拟机作为独立服务器 | 桥接模式            | 确保 IP 不冲突，开放防火墙端口 |
| 安全上网（默认）   | NAT             | 需端口转发才能被外部访问      |
| 完全隔离测试环境   | 仅主机             | 主机与虚拟机互通，但无外网     |
| 复杂多虚拟机网络   | 自定义 LAN Segment | 灵活定义子网和路由规则       |

# Centos 分区设置

> 在安装 CentOS（或 RHEL、Rocky Linux 等同类系统）时，合理的 **磁盘分区** 对系统性能、数据安全和后期维护至关重要。以下是 **CentOS 分区配置的详细指南**，涵盖手动分区方案、推荐大小及注意事项。

## 1. 分区方案（推荐）

### **（1）基础分区（适合大多数场景）**

| **挂载点** | **推荐大小**       | **文件系统** | **作用**                     |
|------------|-------------------|-------------|-----------------------------|
| `/`        | 20 GB~50 GB         | XFS/ext 4    | 根目录，系统核心文件          |
| `/boot`    | 1 GB               | ext 4        | 启动引导文件（必选）          |
| `/home`    | 剩余空间的 30%~50% | XFS/ext 4    | 用户数据存储                 |
| `swap`     | 内存的 1~2 倍 *    | swap        | 虚拟内存（内存≤8 GB 时需配置） |

**swap 分区建议**：
 - 内存 ≤ 4 GB → swap = 内存 × 2
 - 内存 4~8 GB → swap = 内存 × 1
 - 内存 ≥ 8 GB → 可省略（或保留 4 GB 应急）

### （2）高级分区（服务器/生产环境）

| **挂载点** | **推荐大小**       | **作用**                     |
|------------|-------------------|-----------------------------|
| `/var`     | 10 GB~50 GB         | 日志、缓存文件（频繁写入）    |
| `/opt`     | 10 GB~20 GB         | 第三方软件安装目录           |
| `/tmp`     | 5 GB~10 GB          | 临时文件（可定期清理）        |

## 2. 手动分区步骤（安装时配置）

### （1）进入分区界面

1. 启动 CentOS 安装镜像，选择 **“Install CentOS”**。
2. 在 **“安装位置”**（Installation Destination）界面，选择磁盘。
3. 点击 **“我要配置分区”**（I will configure partitioning）→ **“完成”**。

### （2）创建分区表

- **新磁盘**：选择 **“标准分区”**（Standard Partition）或 **LVM**（推荐动态扩容）。
- **GPT vs MBR**：
  - 磁盘 > 2 TB → 必须选 **GPT**。
  - 旧系统兼容 → 可选 **MBR**。

### （3）添加分区

点击 **“+”** 逐个添加分区（以 XFS 文件系统为例）：

| **挂载点** | **大小** | **文件系统** | **其他选项**                |
|------------|---------|-------------|----------------------------|
| `/boot`    | 1 GB     | ext 4        | 必选，不可加密              |
| `/`        | 20 GB    | XFS         | 系统核心                    |
| `/home`    | 50 GB    | XFS         | 用户数据                    |
| `swap`     | 8 GB     | swap        | 根据内存调整                |

### （4）确认并应用

- 检查分区布局，点击 **“完成”** → **“接受更改”**。

## 3. 分区方案示例

### （1）桌面开发环境（100 GB 磁盘）

- `/boot`：1 GB（ext 4）
- `/`：30 GB（XFS）
- `/home`：60 GB（XFS）
- `swap`：8 GB（内存为 8 GB 时）

### （2）服务器生产环境（500 GB 磁盘）

- `/boot`：1 GB（ext 4）
- `/`：50 GB（XFS）
- `/home`：100 GB（XFS）
- `/var`：50 GB（XFS，日志频繁写入）
- `/opt`：20 GB（XFS，第三方软件）
- `swap`：4 GB（内存为 16 GB 时）

## 4. 关键注意事项

### （1）必须存在的分区

- **`/boot`**：
  独立分区且不可加密（否则系统无法启动）。
- **`/`**：
  根分区必须存在，剩余空间可分配给其他目录。

### （2）文件系统选择

- **XFS**：CentOS 7+ 默认，适合大文件和高性能场景。
- **ext 4**：兼容性好，适合小文件频繁读写。

### （3）LVM vs 标准分区

- **LVM（逻辑卷管理）**：
  支持动态扩容（生产环境推荐），但配置稍复杂。
- **标准分区**：
  简单直接，但扩容需手动调整。

### （4）加密分区

- 如需加密数据，可勾选 **“加密”**（如 `/home`），但会牺牲部分性能。

## 5. 后期调整分区

### （1）扩展 LVM 分区

```bash
# 查看卷组空间
vgdisplay

# 扩展逻辑卷（如 /home）
lvextend -L +10G /dev/mapper/centos-home
xfs_growfs /home  # 调整文件系统（XFS）
resize2fs /dev/mapper/centos-home  # ext4 用此命令
```

### （2）添加新磁盘

1. 物理连接磁盘后，使用 `fdisk` 或 `parted` 分区。
2. 格式化并挂载：

   ```bash
   mkfs.xfs /dev/sdb1
   mount /dev/sdb1 /mnt/data
   ```

## 6. 常见问题

### Q 1: `/boot` 分区为什么必须独立？

- 引导加载器（如 GRUB）需直接访问 `/boot`，若与其他分区合并可能导致启动失败。

### Q 2: 不分配 `swap` 会怎样？

- 物理内存耗尽时，系统可能崩溃。建议至少保留少量 `swap`。

### Q 3: 如何查看现有分区？

```bash
lsblk            # 查看磁盘和分区
df -Th           # 查看挂载点和文件系统
```

## 总结

- **基础分区**：`/boot` + `/` + `/home` + `swap`。
- **服务器分区**：增加 `/var`、`/opt` 等独立分区。
- **生产环境推荐 LVM**，便于后期扩容。
- **加密敏感数据**（如 `/home`），但避免加密 `/boot`。

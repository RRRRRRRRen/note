# 运算符

## 算数运算符

> SQL 中的算术运算符主要用于数值类型的字段或表达式之间的计算操作，常用于 `SELECT` 查询、`UPDATE` 赋值等语句中。

### 1. 常见算术运算符

| 运算符 | 含义         | 示例    |
| ------ | ------------ | ------- |
| `+`    | 加法         | `a + b` |
| `-`    | 减法         | `a - b` |
| `*`    | 乘法         | `a * b` |
| `/`    | 除法         | `a / b` |
| `%`    | 取模（求余） | `a % b` |

### 2. 注意事项

- / 运算符在整数除法中，**结果可能是小数**，取决于字段的数据类型。

- % 运算符在 MySQL 中可直接用于模运算（不同于某些 SQL 方言，如 Oracle 使用 MOD(a, b)）。

- 空值参与计算时，结果通常为 NULL。例如：

```sql
SELECT NULL + 5;  -- 结果为 NULL
```

## 比较运算符

> 比较运算符用于在 SQL 中比较两个值的大小、是否相等等，通常出现在 `WHERE` 子句中，用于过滤符合条件的数据。

**常见的比较运算符**

| 运算符     | 含义     | 示例           |
| ---------- | -------- | -------------- |
| `=`        | 等于     | `price = 10`   |
| `<=>`      | 安全等于 | `price <=> 10` |
| `<>`/ `!=` | 不等于   | `price <> 10`  |
| `>`        | 大于     | `price > 10`   |
| `<`        | 小于     | `price < 10`   |
| `>=`       | 大于等于 | `price >= 10`  |
| `<=`       | 小于等于 | `price <= 10`  |

### 1. `=`

注意

字符串比较存在隐式准换，如果转换不成功，则视为 0

两边都是字符串的话，按照 ansi 的比较规则进行比较

只要与 null 进行比较，结果就为 null

```sql
SELECT 1 = 2, 1 = '1', 1 = 'a', 0 = 'a' FROM DUAL;
```

返回

0 1 0 1

### 2. `<=>`

注意

用于判断 null，null 与 null 判断会返回 1

只有这个比较运算符可以判断是否为 null，其他判断都返回 null

## 关键字式比较运算符

> 很好，你提到的 IS NULL 属于 **特殊的比较语法**，在 SQL 中除了基本的 =, <>, >, < 这些通用比较运算符，还有一些类似 IS NULL 的 **关键字式比较运算符**，常用于处理集合、区间、模式匹配等。

**关键字式比较运算符速查表**

| **类型**   | **运算符**                         |
| ---------- | ---------------------------------- |
| 空值判断   | IS NULL, IS NOT NULL               |
| 范围判断   | BETWEEN, NOT BETWEEN               |
| 集合判断   | IN, NOT IN                         |
| 模式匹配   | LIKE, NOT LIKE, REGEXP, NOT REGEXP |
| 布尔值判断 | IS TRUE, IS FALSE, IS UNKNOWN      |
| 子查询判断 | EXISTS, NOT EXISTS                 |

### 1. 空值判断

| **语法**    | **含义**          |
| ----------- | ----------------- |
| IS NULL     | 判断是否为 NULL   |
| IS NOT NULL | 判断是否不为 NULL |

```sql
SELECT last_name, salary
FROM employees
WHERE commission_pct IS NOT NULL;
```

```sql
SELECT last_name, salary
FROM employees
WHERE ISNULL(commission_pct);
```

### 2. 范围判断

| **语法**            | **含义**                         |
| ------------------- | -------------------------------- |
| BETWEEN a AND b     | 判断是否在区间 [a, b] 内，含边界 |
| NOT BETWEEN a AND b | 判断是否不在区间 [a, b] 内       |

**注意**

- a 和 b 即上限和下限，不能交换顺序。

**示例：**

```sql
SELECT * FROM products
WHERE price BETWEEN 3 AND 6;
```

### 3. 集合判断

| **语法**                 | **含义**                     |
| ------------------------ | ---------------------------- |
| IN (值 1, 值 2, ...)     | 判断是否属于某个集合中的值   |
| NOT IN (值 1, 值 2, ...) | 判断是否不属于某个集合中的值 |

**示例：**

```sql
SELECT * FROM products
WHERE name IN ('Apple', 'Mango');
```

### 4. 模式匹配

| **语法**       | **含义**                      |
| -------------- | ----------------------------- |
| LIKE           | 模糊匹配，支持 % 和 \_ 通配符 |
| NOT LIKE       | 不匹配给定模式                |
| REGEXP / RLIKE | 使用正则表达式进行匹配        |
| NOT REGEXP     | 正则表达式不匹配              |

**通配符说明：**

- %：匹配任意多个字符（包括 0 个）

- \_：匹配任意一个字符
- 如果需要匹配字符`_`等字符时，可是使用转义符`\`匹配

**示例：**

```sql
-- 查询以 'A' 开头的商品名
SELECT * FROM products
WHERE name LIKE 'A%';

-- 查询名称中包含 "an" 的商品
SELECT * FROM products
WHERE name LIKE '%an%';
```

### 5. 布尔判断

| **语法**   | **含义**                                        |
| ---------- | ----------------------------------------------- |
| IS TRUE    | 判断是否为 TRUE（在布尔表达式中）               |
| IS FALSE   | 判断是否为 FALSE                                |
| IS UNKNOWN | 判断布尔表达式结果是否为 UNKNOWN（通常为 NULL） |

### 6. 其它常见结构

| **语法**            | **含义**               |
| ------------------- | ---------------------- |
| EXISTS (子查询)     | 判断子查询是否有结果   |
| NOT EXISTS (子查询) | 判断子查询是否没有结果 |

## 逻辑运算符

> 逻辑运算符主要是用来组合多个判断条件的，一般用于 WHERE、HAVING 等子句中，最终返回一个布尔值：TRUE / FALSE / UNKNOWN。

### 1. 常见逻辑运算符

**AND**：并且，两个条件都成立才为真

```sql
SELECT * FROM products
WHERE price > 3 AND stock < 50;
```

**OR**：或者，只要有一个条件成立就为真

```sql
SELECT * FROM products
WHERE price < 2 OR stock > 100;
```

**NOT**：取反

```sql
SELECT * FROM products
WHERE NOT price = 5;
```

**XOR**：异或

```sql
SELECT * FROM products
WHERE price < 2 XOR stock > 100;
```

### 2. 逻辑优先级

**默认顺序**

NOT > AND > OR

**例子**

```sql
-- 这句容易歧义：
SELECT * FROM products
WHERE price > 3 OR price < 2 AND stock > 50;

-- 推荐加括号明确意图：
SELECT * FROM products
WHERE price > 3 OR (price < 2 AND stock > 50);
```

### 3. NULL 的特殊情况

- NULL 不是 TRUE，也不是 FALSE，它是 **UNKNOWN**。

- 这会导致一些逻辑判断“看起来没问题”，其实结果是 NULL，不会选中任何行。

**例如**

```sql
SELECT * FROM products
WHERE discount > 0.9;  -- 如果 discount 是 NULL，这个条件返回 NULL，不是 FALSE
```

**正确做法**

```sql
WHERE discount IS NOT NULL AND discount > 0.9;
```

## 位运算符

> 好嘞～虽然在 SQL 中不太常用，但 **位运算符** 也是 SQL 支持的一种运算方式，适用于需要处理**权限标志位**、**状态组合**、**压缩存储的整型字段**等场景。
>
> 位运算（Bitwise Operation）是直接对整数的二进制位进行操作。SQL（尤其是 MySQL）中也支持这一类操作，通常适用于整数类型字段。

### 1. 常见的位运算符

| **运算符** | **名称**     | **含义**                                        | **示例**               |
| ---------- | ------------ | ----------------------------------------------- | ---------------------- |
| &          | 按位与 AND   | 两位都为 1，则结果为 1                          | 6 & 3 = 2              |
| `          | `            | 按位或 OR                                       | 有一位为 1，则结果为 1 |
| ^          | 按位异或 XOR | 不同为 1，相同为 0                              | 6 ^ 3 = 5              |
| ~          | 按位取反 NOT | 对所有位取反（在 MySQL 中是补码）               | ~6 = -7                |
| <<         | 左移         | 所有位向左移动，低位补 0，相当于乘以 2 的幂     | 3 << 2 = 12            |
| >>         | 右移         | 所有位向右移动，高位补符号位，相当于除以 2 的幂 | 8 >> 2 = 2             |

### 2. 注意事项

- 位运算只能用于整数类型字段。

- ~ 的结果是负数，因为 MySQL 使用补码方式处理。

- 在业务层维护权限位时，最好封装好权限掩码，避免魔法数字。

## 运算符优先级

> 好问题！在 SQL 中，多个运算符组合使用时是有 **优先级**（也叫操作符优先顺序）的，了解这个可以避免写出逻辑歧义的语句，避免出现“我写的不是我想的”。

### 1. 运算符优先级表（从高到低）

| **优先级** | **运算符**                                 | **类型** | **示例**                 |
| ---------- | ------------------------------------------ | -------- | ------------------------ |
| 1          | ()                                         | 括号     | (price + tax) \* 0.9     |
| 2          | \*, /, %                                   | 算术运算 | price \* 1.05            |
| 3          | +, -                                       | 算术运算 | price - discount         |
| 4          | =, !=, <, >, <=, >=, IS, LIKE, BETWEEN, IN | 比较运算 | price >= 100             |
| 5          | NOT                                        | 逻辑非   | NOT price > 5            |
| 6          | AND                                        | 逻辑与   | price > 3 AND stock > 10 |
| 7          | OR                                         | 逻辑或   | stock < 10 OR price < 2  |

### 2. 推荐习惯

- **始终用括号明确你的逻辑组合**，特别是有 AND 和 OR 混用的时候。

- 一些数据库（包括 MySQL）虽然能根据优先级解析，但加括号更安全、清晰、可维护。

- 括号还能帮助你调试 SQL 时快速分块分析。

# `useradd` 创建用户

> `useradd` 是 Linux 系统中用于创建新用户的命令。它可以用来为系统添加新的用户账户，并且可以指定该用户的相关信息，如用户的主目录、用户组、登录 shell 等。`useradd` 是一个低级别的工具，它通常会配合其他命令（如 `passwd`）一起使用，以便设置用户的密码等其他信息。

## 1. 基本语法

```bash
useradd [选项] 用户名
```

## 2. 选项参数

### **`-m`**：创建用户的主目录

- 使用 `-m` 选项时，`useradd` 会为新用户创建一个主目录。主目录通常位于 `/home/用户名` 目录下。

    ```bash
    sudo useradd -m newuser
    ```

    这个命令会创建一个名为 `newuser` 的用户，并在 `/home/newuser` 下创建该用户的主目录。

### **`-d`**：指定用户的主目录

- 你可以使用 `-d` 选项指定一个不同的目录作为该用户的主目录，而不是默认的 `/home/用户名`。

    ```bash
    sudo useradd -d /custom/directory newuser
    ```

    这个命令会为用户 `newuser` 创建一个主目录 `/custom/directory`。

### **`-s`**：指定登录 shell

- 使用 `-s` 选项，你可以为新用户指定一个特定的登录 shell。默认情况下，用户会使用 `/bin/bash` 作为登录 shell。

    ```bash
    sudo useradd -s /bin/zsh newuser
    ```

    这个命令会将用户 `newuser` 的默认登录 shell 设置为 `/bin/zsh`。

### **`-g`**：指定用户主组

- `-g` 选项用于指定新用户的主组。通常情况下，每个用户会有一个与用户名相同的默认组，但你也可以指定一个已有的用户组。

    ```bash
    sudo useradd -g developers newuser
    ```

    这个命令会将 `newuser` 用户的主组设置为 `developers`。

### **`-G`**：指定附加组

- `-G` 选项允许你指定一个或多个附加组，用户会被添加到这些附加组中。你可以指定多个组，并用逗号分隔。

    ```bash
    sudo useradd -G wheel,admin newuser
    ```

    这个命令会将用户 `newuser` 添加到 `wheel` 和 `admin` 两个附加组。

### **`-e`**：设置账户过期日期

- `-e` 选项允许你设置用户账户的过期日期，格式为 `YYYY-MM-DD`。

    ```bash
    sudo useradd -e 2025-12-31 newuser
    ```

    这个命令会将 `newuser` 的账户过期日期设置为 2025 年 12 月 31 日。

### **`-c`**：设置用户的注释

- `-c` 选项可以用来为新用户设置一些注释信息，例如全名或其他信息。

    ```bash
    sudo useradd -c "John Doe, Developer" newuser
    ```

    这个命令会为 `newuser` 设置注释信息 `"John Doe, Developer"`，可以用 `getent passwd newuser` 查看这些信息。

## 3. 示例

### 示例 1：创建一个默认用户

```bash
sudo useradd newuser
```

这会创建一个名为 `newuser` 的用户，并为其创建一个默认的主目录 `/home/newuser`，并且用户将使用默认的 `/bin/bash` shell。

### 示例 2：创建带有主目录和特定 shell 的用户

```bash
sudo useradd -m -s /bin/zsh newuser
```

这会创建一个名为 `newuser` 的用户，且为其创建主目录 `/home/newuser`，同时将其登录 shell 设置为 `/bin/zsh`。

### 示例 3：创建一个属于多个组的用户

```bash
sudo useradd -m -G wheel,admin newuser
```

这会创建一个名为 `newuser` 的用户，并将其添加到 `wheel` 和 `admin` 组。

### 示例 4：创建带注释的用户

```bash
sudo useradd -m -c "Jane Doe, IT Support" newuser
```

这会创建一个名为 `newuser` 的用户，并设置注释信息 `"Jane Doe, IT Support"`。

### 示例 5：创建一个过期日期的用户

```bash
sudo useradd -e 2025-12-31 newuser
```

这会创建一个名为 `newuser` 的用户，并将其账户设置为 2025 年 12 月 31 日过期。

---

# `passwd` 设置用户密码

> `passwd` 是 Linux 系统中用来设置或更改用户密码的命令。它允许管理员和用户自己设置或更改自己的密码。通常，只有管理员（`root` 用户）才有权限修改其他用户的密码，而普通用户只能修改自己的密码。

## 1. 基本语法

```bash
passwd [选项] [用户名]
```

- **用户名**：如果不指定用户名，`passwd` 命令会默认操作当前登录用户的密码。
- **选项**：你可以使用一些选项来控制命令的行为，例如修改过期时间、强制用户修改密码等。

## 2. 选项参数

### 默认

默认情况下，执行 `passwd` 不带任何参数时，命令会要求你输入当前密码，然后输入并确认新密码。用户只能修改自己的密码，不能修改其他用户的密码，除非是管理员。

```bash
passwd
```

执行命令后，系统会提示你：

```
当前密码: [输入当前密码]
新密码: [输入新密码]
重新输入新密码: [确认新密码]
```

### -e：强制用户在下次登录时修改密码

你可以使用 `-e` 选项强制用户在下次登录时修改密码。这对于用户初次登录后更改密码非常有用，尤其是在设置默认密码时。

```bash
sudo passwd -e username
```

### -l：禁用用户的密码

你可以通过 `-l` 选项锁定用户的密码，禁止用户通过密码登录。虽然该命令不会删除用户的账号或文件，但会锁定其密码，用户将无法登录系统。

```bash
sudo passwd -l username
```

### -u：解锁用户的密码

如果之前使用了 `-l` 锁定了用户的密码，可以使用 `-u` 选项来解锁用户的密码，允许其再次登录。

```bash
sudo passwd -u username
```

### -x：设置密码过期日期

你可以使用 `-x` 选项来设置密码的最大使用期限（单位为天）。当超过指定天数后，用户的密码将被强制要求更改。

```bash
sudo passwd -x 30 username
```

此命令会设置 `newuser` 用户的密码在 30 天后过期，用户必须更改密码才能继续使用账户。

### -n：设置密码最小有效期限

通过 `-n` 选项，你可以设置用户修改密码后，多久才能再次修改密码。通常会设置一个最小时间，防止用户频繁更改密码。

```bash
sudo passwd -n 7 username
```

这表示 `newuser` 用户的密码必须在 7 天后才能再次更改。

### -w：设置密码过期警告

你可以使用 `-w` 选项来设置密码到期之前的警告天数，用户将在此天数内收到密码即将到期的警告。

```bash
sudo passwd -w 7 username
```

这表示 `newuser` 用户将在密码到期前 7 天收到警告。

## 3. **密码策略**

在一些 Linux 系统中，密码的强度受到密码策略的限制。密码策略通常通过 PAM（Pluggable Authentication Modules）来配置。你可以设置密码的最小长度、字符要求（如数字、大小写字母、特殊字符等）以及密码的过期周期等。

- **/etc/login.defs**：此文件包含有关密码策略的默认设置。
    
- **/etc/pam.d/common-password**：通过此文件可以配置 PAM 密码策略。

---

# `userdel` 删除用户

> `userdel` 是一个用于删除 Linux 系统中用户的命令，通常用于删除系统中的用户账户。它会删除指定用户的账户信息，但不会自动删除该用户的文件或主目录，除非你使用特定选项。
>
> `userdel` 命令是 **Red Hat 系列（如 CentOS、Fedora、RHEL）** 和其他一些 Linux 发行版中用于删除用户的标准工具。

## 1. 基本语法

```bash
userdel [选项] 用户名
```

## 2. 常用选项

### 默认：删除用户但保留其主目录

最基本的用法是删除用户账户，不会删除该用户的文件和主目录。

```bash
sudo userdel username
```

### -r：删除用户账户及其主目录

如果你希望删除用户及其主目录和所有相关的文件，可以使用 `-r` 选项。此选项会删除用户的账户以及该用户的主目录（默认情况下通常位于 `/home/username`）。

```bash
sudo userdel -r username
```

### -f：强制删除用户

如果用户当前正在登录，或者该用户有一些进程在运行，你通常无法删除该用户。你可以使用 `-f` 强制删除用户。

```bash
sudo userdel -f username
```

请注意，强制删除用户可能会导致一些进程和资源的问题，因此在使用该选项时要小心。

## 3. 删除用户时的一些细节

- `userdel` 命令删除的用户数据通常包括 `/etc/passwd` 中的记录，但不会删除该用户文件系统中的所有文件。
    
- `userdel` 不会自动删除用户邮箱、文件或其他资源。如果要完全删除一个用户的所有数据和文件，最好手动检查 `/home/username` 目录，并确保没有遗留的文件。

## 5. **删除用户后的处理**

如果你删除了用户，确保以下事项：

- 用户的主目录（除非使用 `-r` 选项）将继续存在。如果需要删除这些文件，可以手动清理。
- 需要检查用户的文件夹权限。如果你删除了一个用户，但用户仍然拥有一些文件或目录的所有权，可能需要更改文件的所有权或删除这些文件。

---

# `id` 查看用户信息

> `id` 命令是 Linux 系统中的一个命令，用于显示当前用户或指定用户的用户 ID（UID）、组 ID（GID）以及所属的附加组（groups）。该命令是一个非常有用的工具，可以帮助你了解用户的身份和权限。

## 1. 基本语法

```bash
id [选项] [用户名]
```

## 2. 常用用法

### 2.1 查看当前用户的 UID 和 GID

如果没有指定用户名，`id` 命令会显示当前登录用户的用户 ID（UID）、主组 ID（GID）以及用户所属的所有附加组。

```bash
id
```

### 2.2 查看指定用户的 UID 和 GID

可以通过指定用户名来查看该用户的 UID、主组 GID 和附加组。

```bash
id username
```

### 2.3 查看指定用户的组信息

使用 `-G` 选项可以显示指定用户的所有附加组 ID（GID）。

```bash
id -G username
```

### 2.4 查看指定用户的组名

使用 `-g` 选项显示指定用户的主组的 GID，使用 `-n` 选项则可以显示组的名称，而不仅仅是 GID。

```bash
id -g -n username
```

### 2.5 显示当前用户的 UID 和所有组名

使用 `-u` 和 `-G` 选项，可以分别显示当前用户的 UID 和其所属的所有附加组名。

```bash
id -u
```

要查看当前用户所属的所有附加组名，可以使用：

```bash
id -Gn
```

## 3. **选项说明**

- `-u`：显示当前用户的 UID。
- `-g`：显示当前用户的主组的 GID。
- `-G`：显示当前用户的所有附加组的 GID。
- `-n`：显示组名而不是 GID。
- `-u username`：显示指定用户的 UID。
- `-g username`：显示指定用户的主组 GID。
- `-G username`：显示指定用户的附加组 GID。
- `-Gn`：显示指定用户的所有附加组名。

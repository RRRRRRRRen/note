# JS åŸºç¡€

## 1. æ•°æ®ç±»å‹

### åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆ7ç§ï¼‰

å­˜å‚¨åœ¨**æ ˆ**ä¸­ï¼ŒæŒ‰å€¼è®¿é—®ï¼Œå¤§å°å›ºå®š

- `undefined` - æœªå®šä¹‰
- `null` - ç©ºå¯¹è±¡æŒ‡é’ˆ
- `boolean` - å¸ƒå°”å€¼
- `number` - æ•°å­—
- `string` - å­—ç¬¦ä¸²
- `symbol` - å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆES6ï¼‰
- `bigInt` - å¤§æ•´æ•°ï¼ˆES2020ï¼‰

### å¼•ç”¨æ•°æ®ç±»å‹

å­˜å‚¨åœ¨**å †**ä¸­ï¼Œæ ˆä¸­å­˜å‚¨æŒ‡é’ˆï¼ŒæŒ‰å¼•ç”¨è®¿é—®

- `object` - å¯¹è±¡ï¼ˆåŒ…æ‹¬ Arrayã€Functionã€Dateã€RegExp ç­‰ï¼‰

### ç‰¹æ®Šç±»å‹è¯´æ˜

**Symbol** - åˆ›å»ºå”¯ä¸€ä¸å¯å˜çš„å€¼ï¼Œè§£å†³å…¨å±€å˜é‡å†²çª

```js
// ç›´æ¥è°ƒç”¨ï¼Œä¸ä½¿ç”¨ new
const sym1 = Symbol();
const sym2 = Symbol('foo');
const sym3 = Symbol('foo');
console.log(sym2 === sym3); // false - æ¯æ¬¡éƒ½æ˜¯å”¯ä¸€çš„
```

**BigInt** - è¡¨ç¤ºè¶…è¿‡å®‰å…¨æ•´æ•°èŒƒå›´çš„å¤§æ•´æ•°

```js
const bigNum = 9007199254740991n; // æœ«å°¾åŠ  n
const bigNum2 = BigInt(9007199254740991);
```

## 2. å †æ ˆå†…å­˜

### æ•°æ®ç»“æ„æ¦‚å¿µ

- **æ ˆï¼ˆStackï¼‰**ï¼šå…ˆè¿›åå‡ºï¼ˆLIFOï¼‰ï¼Œç±»ä¼¼å ç›˜å­
- **å †ï¼ˆHeapï¼‰**ï¼šä¼˜å…ˆé˜Ÿåˆ—ï¼ŒæŒ‰ä¼˜å…ˆçº§æ’åº

### JavaScript ä¸­çš„å­˜å‚¨æ–¹å¼

| ç±»å‹ | å­˜å‚¨ä½ç½® | ç‰¹ç‚¹ | è®¿é—®æ–¹å¼ |
|------|---------|------|---------|
| åŸºæœ¬ç±»å‹ | æ ˆ | å¤§å°å›ºå®šï¼Œç›´æ¥å­˜å€¼ | æŒ‰å€¼è®¿é—® |
| å¼•ç”¨ç±»å‹ | å † | å¤§å°ä¸å›ºå®šï¼Œæ ˆä¸­å­˜æŒ‡é’ˆ | æŒ‰å¼•ç”¨è®¿é—® |

**ğŸ’¡ é‡ç‚¹ç†è§£**ï¼š

```js
// åŸºæœ¬ç±»å‹ - å¤åˆ¶å€¼
let a = 10;
let b = a;  // å¤åˆ¶å€¼
b = 20;
console.log(a); // 10 - a ä¸å—å½±å“

// å¼•ç”¨ç±»å‹ - å¤åˆ¶å¼•ç”¨
let obj1 = { name: 'Alice' };
let obj2 = obj1;  // å¤åˆ¶å¼•ç”¨ï¼ˆæŒ‡é’ˆï¼‰
obj2.name = 'Bob';
console.log(obj1.name); // 'Bob' - obj1 ä¹Ÿè¢«ä¿®æ”¹äº†
```

## 3. ç±»å‹æ£€æµ‹æ–¹æ³•

### æ–¹æ³•å¯¹æ¯”

| æ–¹æ³•                                 | é€‚ç”¨åœºæ™¯   | ä¼˜ç‚¹       | ç¼ºç‚¹                                  |
| ---------------------------------- | ------ | -------- | ----------------------------------- |
| `typeof`                           | åŸºæœ¬ç±»å‹æ£€æµ‹ | ç®€å•å¿«é€Ÿ     | âš ï¸ `null` è¿”å› `"object"`<br>æ— æ³•åŒºåˆ†å¯¹è±¡ç±»å‹ |
| `instanceof`                       | å¼•ç”¨ç±»å‹æ£€æµ‹ | æ£€æµ‹åŸå‹é“¾    | âŒ ä¸èƒ½æ£€æµ‹åŸºæœ¬ç±»å‹<br>âŒ ä¸èƒ½è·¨ iframe          |
| `constructor`                      | é€šç”¨æ£€æµ‹   | å¯æ£€æµ‹å¤§éƒ¨åˆ†ç±»å‹ | âš ï¸ æ˜“è¢«ä¿®æ”¹<br>âŒ ä¸èƒ½æ£€æµ‹ `null/undefined`  |
| `Object.prototype.toString.call()` | **æ¨è** | âœ… æœ€å‡†ç¡®å¯é   | IE6 ä¸‹æœ‰å…¼å®¹é—®é¢˜                          |

### typeof ä½¿ç”¨ç¤ºä¾‹

```js
typeof undefined;        // "undefined"
typeof true;            // "boolean"
typeof 42;              // "number"
typeof "hello";         // "string"
typeof Symbol();        // "symbol"
typeof 123n;            // "bigint"
typeof function(){};    // "function"

// âš ï¸ ç‰¹æ®Šæƒ…å†µ
typeof null;            // "object" - å†å²é—ç•™bug
typeof [];              // "object"
typeof {};              // "object"
```

### Object.prototype.toString.call() - æœ€ä½³å®è·µ

**åŸç†**ï¼šè¯»å–å¯¹è±¡å†…éƒ¨ `[[Class]]` å±æ€§ï¼Œè¿”å› `[object Type]` æ ¼å¼

**å¸¸è§ç±»å‹æ£€æµ‹**ï¼š

```js
Object.prototype.toString.call(undefined);     // "[object Undefined]"
Object.prototype.toString.call(null);          // "[object Null]"
Object.prototype.toString.call(true);          // "[object Boolean]"
Object.prototype.toString.call(123);           // "[object Number]"
Object.prototype.toString.call("hello");       // "[object String]"
Object.prototype.toString.call(Symbol());      // "[object Symbol]"
Object.prototype.toString.call(123n);          // "[object BigInt]"
Object.prototype.toString.call({});            // "[object Object]"
Object.prototype.toString.call([]);            // "[object Array]"
Object.prototype.toString.call(function(){}); // "[object Function]"
Object.prototype.toString.call(new Date());    // "[object Date]"
Object.prototype.toString.call(/regex/);       // "[object RegExp]"
Object.prototype.toString.call(new Map());     // "[object Map]"
Object.prototype.toString.call(new Set());     // "[object Set]"
```

**å°è£…é€šç”¨ç±»å‹æ£€æµ‹å‡½æ•°**ï¼š

```js
function getType(value) {
  return Object.prototype.toString.call(value).slice(8, -1).toLowerCase();
}

getType([]);        // "array"
getType({});        // "object"
getType(null);      // "null"
getType(undefined); // "undefined"
```

**âš ï¸ å±€é™æ€§**ï¼š

- å®¿ä¸»å¯¹è±¡ï¼ˆDOMã€BOMï¼‰ç»“æœå–å†³äºç¯å¢ƒå®ç°
- è‡ªå®šä¹‰ `Symbol.toStringTag` ä¼šå½±å“ç»“æœ

```js
const custom = { [Symbol.toStringTag]: 'CustomType' };
Object.prototype.toString.call(custom); // "[object CustomType]"
```

## 4. typeof null çš„å†å² Bug

### âš ï¸ æ˜“é”™ç‚¹

```js
typeof null === "object"; // true - è¿™æ˜¯ä¸€ä¸ªå†å²é—ç•™ bugï¼
```

### åŸå› 

JavaScript æœ€åˆç‰ˆæœ¬ä½¿ç”¨ 32 ä½ç³»ç»Ÿï¼Œç”¨ä½ä½å­˜å‚¨å˜é‡ç±»å‹ä¿¡æ¯ï¼š

| ç±»å‹ | æ ‡è¯† |
|------|------|
| å¯¹è±¡ | `000` |
| æ•´æ•° | `1` |
| æµ®ç‚¹æ•° | `010` |
| å­—ç¬¦ä¸² | `100` |
| å¸ƒå°” | `110` |
| undefined | `-2^31`ï¼ˆå…¨ä¸º 1ï¼‰|
| **null** | **å…¨ä¸º 0** |

**é—®é¢˜**ï¼š`null` çš„äºŒè¿›åˆ¶è¡¨ç¤ºå…¨ä¸º 0ï¼Œå‰ä¸‰ä½ä¹Ÿæ˜¯ `000`ï¼Œä¸å¯¹è±¡ç›¸åŒï¼Œå¯¼è‡´è¢«è¯¯åˆ¤ä¸ºå¯¹è±¡ã€‚

## 5. æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜

### âš ï¸ ç»å…¸é—®é¢˜

```js
0.1 + 0.2 === 0.3;  // false
0.1 + 0.2;          // 0.30000000000000004
```

### åŸå› 

JavaScript ä½¿ç”¨ IEEE 754 åŒç²¾åº¦æµ®ç‚¹æ•°æ ‡å‡†ï¼ŒæŸäº›åè¿›åˆ¶å°æ•°æ— æ³•ç²¾ç¡®è¡¨ç¤ºä¸ºäºŒè¿›åˆ¶ã€‚

### âœ… è§£å†³æ–¹æ¡ˆ

ä½¿ç”¨ `Number.EPSILON` åˆ¤æ–­å·®å€¼ï¼š

```js
function isEqual(a, b) {
  return Math.abs(a - b) < Number.EPSILON;
}

isEqual(0.1 + 0.2, 0.3); // true
```

## 6. NaN çš„ç‰¹æ®Šæ€§

### åŸºæœ¬æ¦‚å¿µ

```js
typeof NaN === "number"; // true - NaN å±äº number ç±»å‹
```

**NaN**ï¼ˆNot-a-Numberï¼‰æ˜¯ä¸€ä¸ªè­¦æˆ’å€¼ï¼Œè¡¨ç¤ºæ•°å­¦è¿ç®—å¤±è´¥çš„ç»“æœã€‚

### âš ï¸ é‡è¦ç‰¹æ€§ï¼šéè‡ªåæ€§

```js
NaN === NaN;  // false - NaN æ˜¯å”¯ä¸€ä¸ç­‰äºè‡ªèº«çš„å€¼
NaN !== NaN;  // true
```

### å¦‚ä½•åˆ¤æ–­ NaN

```js
// âŒ é”™è¯¯æ–¹å¼
value === NaN;  // æ°¸è¿œè¿”å› false

// âœ… æ­£ç¡®æ–¹å¼
Number.isNaN(value);
Object.is(value, NaN);
```

## 7. isNaN vs Number.isNaN

### æ ¸å¿ƒåŒºåˆ«

| æ–¹æ³• | è¡Œä¸º | å‡†ç¡®æ€§ |
|------|------|--------|
| `isNaN()` | ä¼šå…ˆè½¬æ¢ä¸ºæ•°å­—å†åˆ¤æ–­ | âŒ ä¸å‡†ç¡® |
| `Number.isNaN()` | åªåˆ¤æ–­æ˜¯å¦ä¸º NaN | âœ… å‡†ç¡® |

### å¯¹æ¯”ç¤ºä¾‹

```js
// isNaN - ä¼šè¿›è¡Œç±»å‹è½¬æ¢
isNaN(NaN);         // true
isNaN("A String");  // true  - å­—ç¬¦ä¸²è½¬æ•°å­—å¤±è´¥
isNaN(undefined);   // true  - undefined è½¬ä¸º NaN
isNaN({});          // true  - å¯¹è±¡è½¬æ•°å­—å¤±è´¥

// Number.isNaN - ä¸è¿›è¡Œç±»å‹è½¬æ¢ï¼Œåªæœ‰çœŸæ­£çš„ NaN æ‰è¿”å› true
Number.isNaN(NaN);        // true
Number.isNaN("A String"); // false - ä¸æ˜¯ NaN
Number.isNaN(undefined);  // false - ä¸æ˜¯ NaN
Number.isNaN({});         // false - ä¸æ˜¯ NaN
```

### ğŸ’¡ æ¨è

**ä¼˜å…ˆä½¿ç”¨ `Number.isNaN()`**ï¼Œå®ƒæ›´å‡†ç¡®ä¸”ä¸ä¼šäº§ç”Ÿæ„å¤–çš„ç±»å‹è½¬æ¢ã€‚

## 8. == æ“ä½œç¬¦çš„ç±»å‹è½¬æ¢è§„åˆ™

### è½¬æ¢æµç¨‹

```js
// == ä¼šè¿›è¡Œç±»å‹è½¬æ¢ï¼Œ=== ä¸ä¼š
```

**åˆ¤æ–­é¡ºåº**ï¼š

1. **ç±»å‹ç›¸åŒ** â†’ ç›´æ¥æ¯”è¾ƒå€¼
2. **null == undefined** â†’ è¿”å› `true`
3. **string == number** â†’ å­—ç¬¦ä¸²è½¬ä¸ºæ•°å­—
4. **boolean == ä»»æ„ç±»å‹** â†’ boolean è½¬ä¸ºæ•°å­—ï¼ˆtrueâ†’1, falseâ†’0ï¼‰
5. **object == åŸå§‹ç±»å‹** â†’ å¯¹è±¡è½¬ä¸ºåŸå§‹ç±»å‹ï¼ˆè°ƒç”¨ `valueOf()` æˆ– `toString()`ï¼‰

### ç¤ºä¾‹

```js
// null å’Œ undefined
null == undefined;     // true
null === undefined;    // false

// å­—ç¬¦ä¸²å’Œæ•°å­—
'123' == 123;         // true - '123' è½¬ä¸º 123
'123' === 123;        // false

// å¸ƒå°”å€¼
true == 1;            // true - true è½¬ä¸º 1
false == 0;           // true - false è½¬ä¸º 0
true == '1';          // true - trueâ†’1, '1'â†’1

// å¯¹è±¡
[1] == 1;             // true - [1].toString() â†’ '1' â†’ 1
[] == 0;              // true - [].toString() â†’ '' â†’ 0
[] == false;          // true - []â†’''â†’0, falseâ†’0
```

### ğŸ’¡ å»ºè®®

**ä¼˜å…ˆä½¿ç”¨ `===`**ï¼Œé¿å…éšå¼ç±»å‹è½¬æ¢å¸¦æ¥çš„æ„å¤–ç»“æœã€‚

## 9. ç±»å‹è½¬æ¢ä¸ºå­—ç¬¦ä¸²

### è½¬æ¢è§„åˆ™

| ç±»å‹ | è½¬æ¢ç»“æœ | ç¤ºä¾‹ |
|------|---------|------|
| `undefined` | `"undefined"` | `String(undefined)` â†’ `"undefined"` |
| `null` | `"null"` | `String(null)` â†’ `"null"` |
| `boolean` | `"true"` / `"false"` | `String(true)` â†’ `"true"` |
| `number` | æ•°å­—å­—ç¬¦ä¸² | `String(123)` â†’ `"123"` |
| `symbol` | åªèƒ½æ˜¾å¼è½¬æ¢ | `String(Symbol())` â†’ `"Symbol()"` |
| `object` | è°ƒç”¨ `toString()` | `String({})` â†’ `"[object Object]"` |

### ç‰¹æ®Šæƒ…å†µ

```js
// æå¤§/æå°æ•°å­—ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•
String(1e21);           // "1e+21"

// Symbol éšå¼è½¬æ¢ä¼šæŠ¥é”™
Symbol() + '';          // âŒ TypeError

// å¯¹è±¡è½¬æ¢
String([1, 2, 3]);      // "1,2,3"
String({ a: 1 });       // "[object Object]"

// è‡ªå®šä¹‰ toString
const obj = {
  toString() {
    return 'custom';
  }
};
String(obj);            // "custom"
```

## 10. ç±»å‹è½¬æ¢ä¸ºæ•°å­—

### è½¬æ¢è§„åˆ™

| ç±»å‹ | è½¬æ¢ç»“æœ | ç¤ºä¾‹ |
|------|---------|------|
| `undefined` | `NaN` | `Number(undefined)` â†’ `NaN` |
| `null` | `0` | `Number(null)` â†’ `0` âš ï¸ |
| `true` | `1` | `Number(true)` â†’ `1` |
| `false` | `0` | `Number(false)` â†’ `0` |
| `string` | è§£ææ•°å­— | `Number("123")` â†’ `123` |
| `""` | `0` | `Number("")` â†’ `0` âš ï¸ |
| `symbol` | æŠ¥é”™ | `Number(Symbol())` â†’ âŒ TypeError |
| `object` | è°ƒç”¨ `valueOf()` / `toString()` | è§ä¸‹æ–¹ |

### âš ï¸ æ˜“é”™ç‚¹

```js
// null è½¬ä¸º 0ï¼Œä¸æ˜¯ NaN
Number(null);           // 0

// ç©ºå­—ç¬¦ä¸²è½¬ä¸º 0
Number('');             // 0
Number('   ');          // 0

// åŒ…å«éæ•°å­—å­—ç¬¦è½¬ä¸º NaN
Number('123abc');       // NaN
Number('abc');          // NaN

// å¯¹è±¡è½¬æ¢
Number([]);             // 0  - [].toString() â†’ '' â†’ 0
Number([5]);            // 5  - [5].toString() â†’ '5' â†’ 5
Number([1, 2]);         // NaN - [1,2].toString() â†’ '1,2' â†’ NaN
Number({});             // NaN
```

### å¯¹è±¡è½¬æ•°å­—çš„è¿‡ç¨‹

1. è°ƒç”¨ `valueOf()`ï¼Œå¦‚æœè¿”å›åŸå§‹å€¼ï¼Œåˆ™è½¬æ¢è¯¥å€¼
2. å¦åˆ™è°ƒç”¨ `toString()`ï¼Œå¦‚æœè¿”å›åŸå§‹å€¼ï¼Œåˆ™è½¬æ¢è¯¥å€¼
3. å¦åˆ™æŠ›å‡º `TypeError`

```js
const obj = {
  valueOf() {
    return 42;
  },
  toString() {
    return '100';
  }
};
Number(obj);  // 42 - ä¼˜å…ˆä½¿ç”¨ valueOf()
```

## 11. ç±»å‹è½¬æ¢ä¸ºå¸ƒå°”å€¼

### å‡å€¼ï¼ˆFalsy Valuesï¼‰

**åªæœ‰ä»¥ä¸‹ 6 ä¸ªå€¼ä¼šè½¬æ¢ä¸º `false`**ï¼š

```js
Boolean(undefined);  // false
Boolean(null);       // false
Boolean(false);      // false
Boolean(0);          // false
Boolean(NaN);        // false
Boolean('');         // false
```

### çœŸå€¼ï¼ˆTruthy Valuesï¼‰

**é™¤å‡å€¼å¤–ï¼Œæ‰€æœ‰å€¼éƒ½ä¸ºçœŸå€¼**ï¼ŒåŒ…æ‹¬ï¼š

```js
Boolean('0');        // true  - éç©ºå­—ç¬¦ä¸²
Boolean('false');    // true  - éç©ºå­—ç¬¦ä¸²
Boolean([]);         // true  - ç©ºæ•°ç»„
Boolean({});         // true  - ç©ºå¯¹è±¡
Boolean(function(){}); // true - å‡½æ•°
```

### âš ï¸ æ˜“é”™ç‚¹

```js
// è¿™äº›éƒ½æ˜¯çœŸå€¼ï¼
Boolean(' ');        // true  - åŒ…å«ç©ºæ ¼çš„å­—ç¬¦ä¸²
Boolean([]);         // true  - ç©ºæ•°ç»„æ˜¯å¯¹è±¡
Boolean({});         // true  - ç©ºå¯¹è±¡
Boolean(new Boolean(false)); // true - å¯¹è±¡åŒ…è£…ç±»å‹
```

## 12. é€»è¾‘è¿ç®—ç¬¦çš„è¿”å›å€¼

### || (æˆ–è¿ç®—ç¬¦)

**è¿”å›ç¬¬ä¸€ä¸ªçœŸå€¼ï¼Œæˆ–æœ€åä¸€ä¸ªå€¼**

```js
// è¿”å›ç¬¬ä¸€ä¸ªçœŸå€¼
'a' || 'b';          // 'a'
0 || 'hello';        // 'hello'
null || undefined || 'default'; // 'default'

// éƒ½ä¸ºå‡å€¼æ—¶ï¼Œè¿”å›æœ€åä¸€ä¸ª
null || undefined;   // undefined
0 || false;          // false
```

**å¸¸è§ç”¨æ³•**ï¼šè®¾ç½®é»˜è®¤å€¼

```js
function greet(name) {
  name = name || 'Guest';  // å¦‚æœ name ä¸ºå‡å€¼ï¼Œä½¿ç”¨ 'Guest'
  return `Hello, ${name}`;
}
```

### && (ä¸è¿ç®—ç¬¦)

**è¿”å›ç¬¬ä¸€ä¸ªå‡å€¼ï¼Œæˆ–æœ€åä¸€ä¸ªå€¼**

```js
// è¿”å›ç¬¬ä¸€ä¸ªå‡å€¼
'a' && 0;            // 0
'hello' && null;     // null
true && false && 'never'; // false

// éƒ½ä¸ºçœŸå€¼æ—¶ï¼Œè¿”å›æœ€åä¸€ä¸ª
'a' && 'b';          // 'b'
1 && 2 && 3;         // 3
```

**å¸¸è§ç”¨æ³•**ï¼šæ¡ä»¶æ‰§è¡Œ

```js
user && user.getName();  // å¦‚æœ user å­˜åœ¨ï¼Œæ‰è°ƒç”¨æ–¹æ³•
isLoggedIn && showDashboard();  // çŸ­è·¯æ±‚å€¼
```

### ğŸ’¡ ç°ä»£æ›¿ä»£æ–¹æ¡ˆ

```js
// ä½¿ç”¨ ?? (ç©ºå€¼åˆå¹¶è¿ç®—ç¬¦) - åªåˆ¤æ–­ null å’Œ undefined
const value = input ?? 'default';  // 0ã€falseã€'' ä¸ä¼šè¢«æ›¿æ¢

// ä½¿ç”¨ ?. (å¯é€‰é“¾)
user?.getName();  // æ›´å®‰å…¨çš„å±æ€§è®¿é—®
```

## 13. Object.is() vs === vs ==

### ä¸‰è€…å¯¹æ¯”

| æ¯”è¾ƒ | `==` | `===` | `Object.is()` |
|------|------|-------|---------------|
| ç±»å‹è½¬æ¢ | âœ… ä¼šè½¬æ¢ | âŒ ä¸è½¬æ¢ | âŒ ä¸è½¬æ¢ |
| `NaN == NaN` | `false` | `false` | `true` âœ… |
| `+0 == -0` | `true` | `true` | `false` âœ… |

### Object.is() çš„ç‰¹æ®Šä¹‹å¤„

```js
// ä¸ === çš„åŒºåˆ«

// 1. NaN çš„æ¯”è¾ƒ
NaN === NaN;           // false
Object.is(NaN, NaN);   // true âœ…

// 2. +0 å’Œ -0 çš„æ¯”è¾ƒ
+0 === -0;             // true
Object.is(+0, -0);     // false âœ…

// å…¶ä»–æƒ…å†µä¸ === ç›¸åŒ
Object.is(1, 1);       // true
Object.is('a', 'a');   // true
Object.is({}, {});     // false - ä¸åŒå¼•ç”¨
```

### ä½¿ç”¨åœºæ™¯

```js
// æ£€æµ‹ NaN
Object.is(value, NaN);  // ç­‰åŒäº Number.isNaN(value)

// åŒºåˆ† +0 å’Œ -0ï¼ˆæå°‘ä½¿ç”¨ï¼‰
Object.is(0, -0);       // false

// ä¸€èˆ¬æƒ…å†µä½¿ç”¨ ===
if (a === b) { /* ... */ }
```

## 14. åŒ…è£…ç±»å‹ï¼ˆWrapper Typesï¼‰

### æ¦‚å¿µ

åŸºæœ¬ç±»å‹æœ¬èº«æ²¡æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œä½† JavaScript ä¼š**è‡ªåŠ¨è£…ç®±**ï¼ˆä¸´æ—¶åŒ…è£…ä¸ºå¯¹è±¡ï¼‰ã€‚

### è‡ªåŠ¨è£…ç®±è¿‡ç¨‹

```js
const str = 'hello';
str.length;              // 5
str.toUpperCase();       // 'HELLO'

// èƒŒåå‘ç”Ÿçš„äº‹æƒ…ï¼š
// 1. åˆ›å»º String å¯¹è±¡ï¼šnew String('hello')
// 2. è°ƒç”¨æ–¹æ³•ï¼šä¸´æ—¶å¯¹è±¡.toUpperCase()
// 3. é”€æ¯ä¸´æ—¶å¯¹è±¡
```

### ä¸‰ç§åŒ…è£…ç±»å‹

```js
// String
const s = 'hello';
typeof s;                // "string"
s instanceof String;     // false

const S = new String('hello');
typeof S;                // "object"
S instanceof String;     // true

// Number
const n = 123;
typeof n;                // "number"

const N = new Number(123);
typeof N;                // "object"

// Boolean
const b = true;
typeof b;                // "boolean"

const B = new Boolean(true);
typeof B;                // "object"
```

### âš ï¸ æ³¨æ„äº‹é¡¹

```js
// ä¸è¦ä½¿ç”¨ new åˆ›å»ºåŒ…è£…å¯¹è±¡
const bool = new Boolean(false);
if (bool) {
  console.log('æ‰§è¡Œäº†');  // ä¼šæ‰§è¡Œï¼å› ä¸ºå¯¹è±¡æ˜¯çœŸå€¼
}

// å¯ä»¥ä¸ç”¨ new è¿›è¡Œç±»å‹è½¬æ¢
String(123);    // "123"
Number('123');  // 123
Boolean(0);     // false
```

## 15. this æŒ‡å‘åˆ¤æ–­

### å››ç§ç»‘å®šæ¨¡å¼

#### 1. é»˜è®¤ç»‘å®šï¼ˆå‡½æ•°è°ƒç”¨ï¼‰

```js
function foo() {
  console.log(this);  // éä¸¥æ ¼æ¨¡å¼ï¼šwindowï¼Œä¸¥æ ¼æ¨¡å¼ï¼šundefined
}
foo();
```

#### 2. éšå¼ç»‘å®šï¼ˆæ–¹æ³•è°ƒç”¨ï¼‰

```js
const obj = {
  name: 'Alice',
  greet() {
    console.log(this.name);  // this æŒ‡å‘ obj
  }
};
obj.greet();  // 'Alice'
```

#### 3. æ˜¾å¼ç»‘å®šï¼ˆcall/apply/bindï¼‰

```js
function greet() {
  console.log(this.name);
}

const user = { name: 'Bob' };

// call - å‚æ•°é€ä¸ªä¼ é€’
greet.call(user);           // 'Bob'
greet.call(user, arg1, arg2);

// apply - å‚æ•°æ•°ç»„ä¼ é€’
greet.apply(user);          // 'Bob'
greet.apply(user, [arg1, arg2]);

// bind - è¿”å›æ–°å‡½æ•°
const boundGreet = greet.bind(user);
boundGreet();               // 'Bob'
```

#### 4. new ç»‘å®šï¼ˆæ„é€ å‡½æ•°ï¼‰

```js
function Person(name) {
  this.name = name;
}
const person = new Person('Charlie');
console.log(person.name);  // 'Charlie' - this æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡
```

### ğŸ”¥ ç»‘å®šä¼˜å…ˆçº§

**new > æ˜¾å¼ç»‘å®š > éšå¼ç»‘å®š > é»˜è®¤ç»‘å®š**

```js
function foo() {
  console.log(this.name);
}

const obj1 = { name: 'obj1', foo };
const obj2 = { name: 'obj2' };

// éšå¼ç»‘å®š
obj1.foo();              // 'obj1'

// æ˜¾å¼ç»‘å®š > éšå¼ç»‘å®š
obj1.foo.call(obj2);     // 'obj2'

// new > æ˜¾å¼ç»‘å®š
const boundFoo = foo.bind(obj1);
const instance = new boundFoo();  // this æŒ‡å‘æ–°å¯¹è±¡ï¼Œä¸æ˜¯ obj1
```

### âš ï¸ æ˜“é”™ç‚¹ï¼šéšå¼ç»‘å®šä¸¢å¤±

```js
const obj = {
  name: 'Alice',
  greet() {
    console.log(this.name);
  }
};

// èµ‹å€¼ç»™å˜é‡ï¼Œä¸¢å¤±ç»‘å®š
const fn = obj.greet;
fn();  // undefined - this å˜ä¸ºå…¨å±€å¯¹è±¡

// ä½œä¸ºå›è°ƒå‡½æ•°
setTimeout(obj.greet, 1000);  // undefined - ä¸¢å¤±ç»‘å®š

// è§£å†³æ–¹æ¡ˆ
setTimeout(() => obj.greet(), 1000);  // 'Alice'
setTimeout(obj.greet.bind(obj), 1000);  // 'Alice'
```

### ğŸ’¡ ç®­å¤´å‡½æ•°çš„ this

ç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ thisï¼Œç»§æ‰¿å¤–å±‚ä½œç”¨åŸŸçš„ thisã€‚

```js
const obj = {
  name: 'Alice',
  greet: () => {
    console.log(this.name);  // this ä¸æ˜¯ objï¼Œè€Œæ˜¯å¤–å±‚ä½œç”¨åŸŸ
  },
  greet2() {
    const arrow = () => {
      console.log(this.name);  // ç»§æ‰¿ greet2 çš„ this
    };
    arrow();
  }
};
```

## 16. Map vs Object

### æ ¸å¿ƒåŒºåˆ«

| ç‰¹æ€§ | Map | Object |
|------|-----|--------|
| é”®çš„ç±»å‹ | **ä»»æ„ç±»å‹** | åªèƒ½æ˜¯ `string` æˆ– `symbol` |
| é”®çš„é¡ºåº | **æŒ‰æ’å…¥é¡ºåº** | æ— åºï¼ˆES2015+ æœ‰åºï¼‰ |
| æ„å¤–çš„é”® | åªæœ‰æ˜¾å¼æ’å…¥çš„é”® | ç»§æ‰¿åŸå‹é“¾ä¸Šçš„é”® |
| è·å–å¤§å° | `map.size` | éœ€æ‰‹åŠ¨è®¡ç®— |
| è¿­ä»£ | ç›´æ¥å¯è¿­ä»£ | éœ€ `Object.keys()` ç­‰ |
| æ€§èƒ½ | **é¢‘ç¹å¢åˆ æ€§èƒ½æ›´å¥½** | é€‚åˆé™æ€æ•°æ® |

### ä½¿ç”¨ç¤ºä¾‹

```js
// Map - é”®å¯ä»¥æ˜¯ä»»æ„ç±»å‹
const map = new Map();
map.set('name', 'Alice');
map.set(123, 'number key');
map.set({}, 'object key');
map.set(true, 'boolean key');

console.log(map.size);        // 4
console.log(map.get('name')); // 'Alice'
map.delete(123);
map.has('name');              // true

// è¿­ä»£
for (const [key, value] of map) {
  console.log(key, value);
}

// Object - é”®åªèƒ½æ˜¯å­—ç¬¦ä¸²æˆ– Symbol
const obj = {
  name: 'Alice',
  123: 'converted to string'  // é”®ä¼šè¢«è½¬ä¸ºå­—ç¬¦ä¸² '123'
};
console.log(obj['123']);      // 'converted to string'
```

### ğŸ’¡ ä½¿ç”¨å»ºè®®

- **ä½¿ç”¨ Map**ï¼šéœ€è¦é¢‘ç¹å¢åˆ ã€é”®ä¸æ˜¯å­—ç¬¦ä¸²ã€éœ€è¦ä¿æŒæ’å…¥é¡ºåº
- **ä½¿ç”¨ Object**ï¼šç®€å•çš„é”®å€¼å¯¹ã€JSON åºåˆ—åŒ–ã€ä½œä¸ºè®°å½•/ç»“æ„ä½“

## 17. String() vs JSON.stringify()

### æ ¸å¿ƒåŒºåˆ«

| ç±»å‹ | `String()` | `JSON.stringify()` |
|------|-----------|-------------------|
| å­—ç¬¦ä¸² | `abc` | `"abc"` (å¸¦å¼•å·) |
| å¯¹è±¡ | `[object Object]` | `{"key":"value"}` |
| æ•°ç»„ | `1,2,3` | `[1,2,3]` |
| ç”¨é€” | ç±»å‹è½¬æ¢ | JSON åºåˆ—åŒ– |

### å¯¹æ¯”ç¤ºä¾‹

```js
// 1. å­—ç¬¦ä¸²
String('abc');           // 'abc'
JSON.stringify('abc');   // '"abc"' - å¸¦å¼•å·çš„ JSON å­—ç¬¦ä¸²

// 2. å¯¹è±¡
String({ key: 'value' });           // '[object Object]'
JSON.stringify({ key: 'value' });   // '{"key":"value"}'

// 3. æ•°ç»„
String([1, 2, 3]);       // '1,2,3'
JSON.stringify([1, 2, 3]); // '[1,2,3]'

// 4. è‡ªå®šä¹‰ toString
const obj = {
  title: 'devpoint',
  toString() {
    return 'custom';
  }
};
String(obj);             // 'custom' - è°ƒç”¨ toString()
JSON.stringify(obj);     // '{"title":"devpoint"}' - å¿½ç•¥ toString()

// 5. ç‰¹æ®Šå€¼
String(undefined);       // 'undefined'
JSON.stringify(undefined); // undefined (ä¸æ˜¯å­—ç¬¦ä¸²)

String(null);            // 'null'
JSON.stringify(null);    // 'null'
```

### ä½¿ç”¨åœºæ™¯

- **String()**ï¼šç±»å‹è½¬æ¢ã€æ˜¾ç¤ºç»™ç”¨æˆ·
- **JSON.stringify()**ï¼šæ•°æ®ä¼ è¾“ã€å­˜å‚¨ã€æ·±æ‹·è´ï¼ˆæœ‰é™åˆ¶ï¼‰

## 18. ç±»æ•°ç»„å¯¹è±¡ï¼ˆArray-likeï¼‰

### æ¦‚å¿µ

æ‹¥æœ‰ `length` å±æ€§å’Œç´¢å¼•å±æ€§çš„å¯¹è±¡ï¼Œä½†**ä¸èƒ½è°ƒç”¨æ•°ç»„æ–¹æ³•**ã€‚

### å¸¸è§ç±»æ•°ç»„

```js
// 1. arguments å¯¹è±¡
function foo() {
  console.log(arguments);        // [1, 2, 3]
  console.log(arguments.length); // 3
  // arguments.push(4);          // âŒ TypeError
}
foo(1, 2, 3);

// 2. DOM æŸ¥è¯¢ç»“æœ
const divs = document.querySelectorAll('div');  // NodeList
const children = document.body.children;        // HTMLCollection

// 3. å­—ç¬¦ä¸²
const str = 'hello';
console.log(str[0]);     // 'h'
console.log(str.length); // 5
```

### è½¬æ¢ä¸ºçœŸæ•°ç»„

```js
const arrayLike = { 0: 'a', 1: 'b', 2: 'c', length: 3 };

// æ–¹æ³• 1ï¼šArray.from() - æ¨è
Array.from(arrayLike);  // ['a', 'b', 'c']

// æ–¹æ³• 2ï¼šæ‰©å±•è¿ç®—ç¬¦
[...arrayLike];  // ['a', 'b', 'c']

// æ–¹æ³• 3ï¼šArray.prototype.slice.call()
Array.prototype.slice.call(arrayLike);  // ['a', 'b', 'c']

// è½¬æ¢åå¯ä»¥ä½¿ç”¨æ•°ç»„æ–¹æ³•
const arr = Array.from(arrayLike);
arr.push('d');
arr.map(x => x.toUpperCase());
```

## 19. Unicode ä¸ç¼–ç 

### åŸºæœ¬æ¦‚å¿µ

- **Unicode**ï¼šå­—ç¬¦é›†ï¼Œä¸ºæ¯ä¸ªå­—ç¬¦åˆ†é…å”¯ä¸€ç¼–å·ï¼ˆç ç‚¹ï¼‰
- **UTF-8/UTF-16/UTF-32**ï¼šç¼–ç æ–¹å¼ï¼Œè§„å®šå¦‚ä½•å­˜å‚¨ Unicode å­—ç¬¦

### åŒºåˆ«

| ç¼–ç  | ç‰¹ç‚¹ | ä½¿ç”¨åœºæ™¯ |
|------|------|---------|
| UTF-8 | å˜é•¿ç¼–ç ï¼ˆ1-4å­—èŠ‚ï¼‰ï¼ŒASCII å…¼å®¹ | ç½‘é¡µã€æ–‡ä»¶å­˜å‚¨ |
| UTF-16 | å˜é•¿ç¼–ç ï¼ˆ2æˆ–4å­—èŠ‚ï¼‰ | JavaScript å†…éƒ¨ç¼–ç  |
| UTF-32 | å®šé•¿ç¼–ç ï¼ˆ4å­—èŠ‚ï¼‰ | å†…å­˜å ç”¨å¤§ï¼Œå°‘ç”¨ |

```js
// JavaScript ä½¿ç”¨ UTF-16
'ğŒ†'.length;  // 2 - éœ€è¦ä¸¤ä¸ªç å…ƒè¡¨ç¤º
'ä½ '.length;  // 1
```

## 20. URL ç¼–ç æ–¹æ³•

### ä¸‰ç§æ–¹æ³•å¯¹æ¯”

| æ–¹æ³• | ç”¨é€” | ç¼–ç èŒƒå›´ |
|------|------|---------|
| `escape()` | âŒ å·²åºŸå¼ƒ | ä¸è¦ä½¿ç”¨ |
| `encodeURI()` | ç¼–ç å®Œæ•´ URL | ä¿ç•™ URL ç»“æ„å­—ç¬¦ |
| `encodeURIComponent()` | ç¼–ç  URL å‚æ•° | ç¼–ç æ‰€æœ‰ç‰¹æ®Šå­—ç¬¦ |

### ä½¿ç”¨ç¤ºä¾‹

```js
const url = 'http://example.com/search?q=hello world&lang=ä¸­æ–‡';

// encodeURI - ä¿æŒ URL å¯ç”¨
encodeURI(url);
// 'http://example.com/search?q=hello%20world&lang=%E4%B8%AD%E6%96%87'
// ä¿ç•™äº† :/?#[]@!$&'()*+,;=

// encodeURIComponent - å®Œå…¨ç¼–ç ï¼Œç”¨äºå‚æ•°
const param = 'hello world&lang=ä¸­æ–‡';
`http://example.com/search?q=${encodeURIComponent(param)}`;
// 'http://example.com/search?q=hello%20world%26lang%3D%E4%B8%AD%E6%96%87'
// & å’Œ = ä¹Ÿè¢«ç¼–ç äº†
```

### ğŸ’¡ ä½¿ç”¨å»ºè®®

```js
// âœ… æ­£ç¡®ï¼šç¼–ç æ•´ä¸ª URL
const fullUrl = 'http://example.com/path with spaces';
encodeURI(fullUrl);

// âœ… æ­£ç¡®ï¼šç¼–ç  URL å‚æ•°
const baseUrl = 'http://example.com/search';
const query = 'hello&world';
`${baseUrl}?q=${encodeURIComponent(query)}`;

// âŒ é”™è¯¯ï¼šå¯¹æ•´ä¸ª URL ä½¿ç”¨ encodeURIComponent
encodeURIComponent('http://example.com');  // 'http%3A%2F%2Fexample.com'
```

## 21. å°¾è°ƒç”¨ä¼˜åŒ–ï¼ˆTail Call Optimizationï¼‰

### æ¦‚å¿µ

**å°¾è°ƒç”¨**ï¼šå‡½æ•°çš„æœ€åä¸€æ­¥æ˜¯è°ƒç”¨å¦ä¸€ä¸ªå‡½æ•°ã€‚

```js
// âœ… æ˜¯å°¾è°ƒç”¨
function f(x) {
  return g(x);
}

// âŒ ä¸æ˜¯å°¾è°ƒç”¨
function f(x) {
  const y = g(x);
  return y;  // è°ƒç”¨åè¿˜æœ‰æ“ä½œ
}

function f(x) {
  return g(x) + 1;  // è°ƒç”¨åè¿˜æœ‰æ“ä½œ
}
```

### ä¼˜åŒ–åŸç†

æ­£å¸¸å‡½æ•°è°ƒç”¨ä¼šä¿ç•™è°ƒç”¨æ ˆï¼š

```js
function factorial(n) {
  if (n === 1) return 1;
  return n * factorial(n - 1);  // ä¸æ˜¯å°¾è°ƒç”¨ï¼Œéœ€è¦ä¿ç•™ä¸Šä¸‹æ–‡
}
// è°ƒç”¨æ ˆï¼šfactorial(5) â†’ factorial(4) â†’ factorial(3) â†’ ...
```

å°¾è°ƒç”¨ä¼˜åŒ–å¯ä»¥å¤ç”¨æ ˆå¸§ï¼š

```js
function factorial(n, total = 1) {
  if (n === 1) return total;
  return factorial(n - 1, n * total);  // å°¾è°ƒç”¨ï¼Œå¯ä»¥ä¼˜åŒ–
}
// è°ƒç”¨æ ˆå§‹ç»ˆåªæœ‰ä¸€å±‚
```

### âš ï¸ é™åˆ¶æ¡ä»¶

- **åªåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ç”Ÿæ•ˆ**
- å‡½æ•°å¿…é¡»æ˜¯å°¾è°ƒç”¨ï¼ˆæœ€åä¸€æ­¥ï¼‰
- ä¸èƒ½å¼•ç”¨å¤–å±‚å‡½æ•°çš„å˜é‡

```js
'use strict';

// âœ… å¯ä»¥ä¼˜åŒ–
function sum(n, acc = 0) {
  if (n === 0) return acc;
  return sum(n - 1, acc + n);
}

// âŒ ä¸èƒ½ä¼˜åŒ– - éä¸¥æ ¼æ¨¡å¼
function sum(n, acc = 0) {
  if (n === 0) return acc;
  return sum(n - 1, acc + n);
}
```

### ğŸ’¡ å®é™…åº”ç”¨

å°¾é€’å½’ä¼˜åŒ–ä¸»è¦ç”¨äºé¿å…æ ˆæº¢å‡ºï¼š

```js
// æ™®é€šé€’å½’ - å¯èƒ½æ ˆæº¢å‡º
function fibonacci(n) {
  if (n <= 1) return n;
  return fibonacci(n - 1) + fibonacci(n - 2);
}

// å°¾é€’å½’ä¼˜åŒ–
function fibonacci(n, a = 0, b = 1) {
  if (n === 0) return a;
  return fibonacci(n - 1, b, a + b);
}
```

## 22. ä¸¥æ ¼æ¨¡å¼ï¼ˆStrict Modeï¼‰

### å¼€å¯æ–¹å¼

```js
// 1. å…¨å±€å¼€å¯
'use strict';
var x = 10;

// 2. å‡½æ•°å†…å¼€å¯
function foo() {
  'use strict';
  // å‡½æ•°å†…ä»£ç ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼
}

// 3. æ¨¡å—å’Œç±»è‡ªåŠ¨å¼€å¯
// ES6 æ¨¡å—å’Œç±»é»˜è®¤ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼
```

### ä¸»è¦é™åˆ¶

#### 1. å˜é‡ç›¸å…³

```js
'use strict';

// âŒ æœªå£°æ˜å˜é‡
x = 10;  // ReferenceError

// âŒ åˆ é™¤å˜é‡
var y = 20;
delete y;  // SyntaxError

// âœ… åªèƒ½åˆ é™¤å¯¹è±¡å±æ€§
const obj = { a: 1 };
delete obj.a;  // OK
```

#### 2. å‡½æ•°ç›¸å…³

```js
'use strict';

// âŒ å‚æ•°é‡å
function foo(a, a, b) {  // SyntaxError
  return a + b;
}

// âŒ arguments.callee
function foo() {
  arguments.callee();  // TypeError
}

// âŒ this æŒ‡å‘ undefined
function foo() {
  console.log(this);  // undefinedï¼ˆéä¸¥æ ¼æ¨¡å¼æ˜¯ windowï¼‰
}
foo();
```

#### 3. å¯¹è±¡ç›¸å…³

```js
'use strict';

// âŒ å¯¹åªè¯»å±æ€§èµ‹å€¼
const obj = {};
Object.defineProperty(obj, 'x', { value: 1, writable: false });
obj.x = 2;  // TypeError

// âŒ åˆ é™¤ä¸å¯åˆ é™¤çš„å±æ€§
delete Object.prototype;  // TypeError

// âŒ å¯¹è±¡å±æ€§é‡åï¼ˆES5ï¼ŒES6 å·²å…è®¸ï¼‰
const obj = { a: 1, a: 2 };  // SyntaxError (ES5)
```

#### 4. å…¶ä»–é™åˆ¶

```js
'use strict';

// âŒ å…«è¿›åˆ¶å­—é¢é‡
const num = 0123;  // SyntaxError

// âŒ with è¯­å¥
with (obj) {  // SyntaxError
  // ...
}

// âŒ eval ä½œç”¨åŸŸéš”ç¦»
eval('var x = 10');
console.log(x);  // ReferenceError - x ä¸åœ¨å¤–å±‚ä½œç”¨åŸŸ
```

### ğŸ’¡ ä¸¥æ ¼æ¨¡å¼çš„å¥½å¤„

1. **æ¶ˆé™¤ä¸åˆç†è¯­æ³•**ï¼šç¦æ­¢ä¸€äº›ä¸å®‰å…¨çš„æ“ä½œ
2. **æé«˜å®‰å…¨æ€§**ï¼š`this` ä¸ä¼šæ„å¤–æŒ‡å‘å…¨å±€å¯¹è±¡
3. **æå‡æ€§èƒ½**ï¼šä¾¿äºå¼•æ“ä¼˜åŒ–
4. **ä¸ºæœªæ¥é“ºè·¯**ï¼šä¿ç•™å…³é”®å­—ï¼ˆ`class`ã€`let`ã€`const` ç­‰ï¼‰

### è‡ªåŠ¨å¼€å¯ä¸¥æ ¼æ¨¡å¼çš„æƒ…å†µ

```js
// 1. ES6 æ¨¡å—
// module.js
export const x = 10;  // è‡ªåŠ¨ä¸¥æ ¼æ¨¡å¼

// 2. ES6 ç±»
class MyClass {
  constructor() {
    // è‡ªåŠ¨ä¸¥æ ¼æ¨¡å¼
  }
}
```

## 23. for...in vs for...of

### æ ¸å¿ƒåŒºåˆ«

| ç‰¹æ€§ | `for...in` | `for...of` |
|------|-----------|-----------|
| éå†å†…å®¹ | å¯¹è±¡çš„**é”®**ï¼ˆkeyï¼‰ | å¯è¿­ä»£å¯¹è±¡çš„**å€¼**ï¼ˆvalueï¼‰ |
| é€‚ç”¨å¯¹è±¡ | æ‰€æœ‰å¯¹è±¡ | å¯è¿­ä»£å¯¹è±¡ï¼ˆArrayã€Stringã€Mapã€Set ç­‰ï¼‰ |
| åŸå‹é“¾ | ä¼šéå†åŸå‹é“¾ä¸Šçš„å¯æšä¸¾å±æ€§ | ä¸ä¼š |
| é¡ºåº | ä¸ä¿è¯é¡ºåº | æŒ‰è¿­ä»£å™¨é¡ºåº |

### ä½¿ç”¨ç¤ºä¾‹

```js
const arr = ['a', 'b', 'c'];
arr.custom = 'custom property';

// for...in - éå†é”®ï¼ˆç´¢å¼•ï¼‰
for (const key in arr) {
  console.log(key);  // '0', '1', '2', 'custom'
}

// for...of - éå†å€¼
for (const value of arr) {
  console.log(value);  // 'a', 'b', 'c'ï¼ˆä¸åŒ…æ‹¬ customï¼‰
}

// å¯¹è±¡éå†
const obj = { a: 1, b: 2, c: 3 };

// for...in - éå†å¯¹è±¡é”®
for (const key in obj) {
  console.log(key, obj[key]);  // 'a' 1, 'b' 2, 'c' 3
}

// for...of - å¯¹è±¡ä¸å¯è¿­ä»£
// for (const value of obj) {}  // âŒ TypeError
```

### âš ï¸ for...in çš„é™·é˜±

```js
Array.prototype.custom = 'inherited';
const arr = [1, 2, 3];

for (const key in arr) {
  console.log(key);  // '0', '1', '2', 'custom' - åŒ…æ‹¬åŸå‹é“¾å±æ€§ï¼
}

// è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨ hasOwnProperty
for (const key in arr) {
  if (arr.hasOwnProperty(key)) {
    console.log(key);  // '0', '1', '2'
  }
}

// æ›´å¥½çš„æ–¹æ¡ˆï¼šä½¿ç”¨ for...of
for (const value of arr) {
  console.log(value);  // 1, 2, 3
}
```

### ğŸ’¡ ä½¿ç”¨å»ºè®®

- **éå†æ•°ç»„**ï¼šä½¿ç”¨ `for...of` æˆ– `forEach()`
- **éå†å¯¹è±¡**ï¼šä½¿ç”¨ `for...in` + `hasOwnProperty()` æˆ– `Object.keys()`
- **éœ€è¦ç´¢å¼•**ï¼šä½¿ç”¨ `forEach()` æˆ–ä¼ ç»Ÿ `for` å¾ªç¯

```js
// æ¨èï¼šéå†æ•°ç»„
arr.forEach((value, index) => {
  console.log(index, value);
});

// æ¨èï¼šéå†å¯¹è±¡
Object.keys(obj).forEach(key => {
  console.log(key, obj[key]);
});

// æˆ–ä½¿ç”¨ Object.entries()
for (const [key, value] of Object.entries(obj)) {
  console.log(key, value);
}
```

## 24. JSON.stringify() æ·±æ‹·è´çš„ç¼ºé™·

### âš ï¸ ä¸»è¦é—®é¢˜

```js
const obj = {
  // 1. å‡½æ•°ä¼šä¸¢å¤±
  fn: function() {},

  // 2. undefined ä¼šä¸¢å¤±
  undef: undefined,

  // 3. Symbol ä¼šä¸¢å¤±
  sym: Symbol('test'),

  // 4. Date å˜æˆå­—ç¬¦ä¸²
  date: new Date(),

  // 5. RegExp å˜æˆç©ºå¯¹è±¡
  regex: /test/g,

  // 6. NaN å’Œ Infinity å˜æˆ null
  nan: NaN,
  inf: Infinity,

  // 7. å¾ªç¯å¼•ç”¨ä¼šæŠ¥é”™
  // circular: obj  // TypeError: Converting circular structure to JSON
};

const copy = JSON.parse(JSON.stringify(obj));

console.log(copy);
// {
//   date: "2024-01-01T00:00:00.000Z",  // å­—ç¬¦ä¸²
//   regex: {},                          // ç©ºå¯¹è±¡
//   nan: null,                          // null
//   inf: null                           // null
//   // fn, undef, sym éƒ½ä¸¢å¤±äº†
// }
```

### è¯¦ç»†è¯´æ˜

| æ•°æ®ç±»å‹ | è½¬æ¢ç»“æœ | è¯´æ˜ |
|---------|---------|------|
| `function` | ä¸¢å¤± | å‡½æ•°æ— æ³•åºåˆ—åŒ– |
| `undefined` | ä¸¢å¤± | ä½œä¸ºå¯¹è±¡å±æ€§æ—¶ä¸¢å¤± |
| `Symbol` | ä¸¢å¤± | æ— æ³•åºåˆ—åŒ– |
| `Date` | å­—ç¬¦ä¸² | è½¬ä¸º ISO å­—ç¬¦ä¸² |
| `RegExp` | `{}` | å˜æˆç©ºå¯¹è±¡ |
| `NaN` / `Infinity` | `null` | ç‰¹æ®Šæ•°å­—å€¼å˜ null |
| å¾ªç¯å¼•ç”¨ | æŠ¥é”™ | æŠ›å‡º TypeError |
| `Map` / `Set` | `{}` | å˜æˆç©ºå¯¹è±¡ |

### ğŸ’¡ æ›¿ä»£æ–¹æ¡ˆ

```js
// 1. ä½¿ç”¨ structuredCloneï¼ˆç°ä»£æµè§ˆå™¨ï¼‰
const copy = structuredClone(obj);  // æ”¯æŒ Dateã€RegExpã€Mapã€Set ç­‰

// 2. ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“
import cloneDeep from 'lodash/cloneDeep';
const copy = cloneDeep(obj);

// 3. æ‰‹åŠ¨å®ç°æ·±æ‹·è´
function deepClone(obj, hash = new WeakMap()) {
  if (obj === null || typeof obj !== 'object') return obj;
  if (obj instanceof Date) return new Date(obj);
  if (obj instanceof RegExp) return new RegExp(obj);

  // å¤„ç†å¾ªç¯å¼•ç”¨
  if (hash.has(obj)) return hash.get(obj);

  const clone = Array.isArray(obj) ? [] : {};
  hash.set(obj, clone);

  for (const key in obj) {
    if (obj.hasOwnProperty(key)) {
      clone[key] = deepClone(obj[key], hash);
    }
  }

  return clone;
}
```

## 25. includes() vs indexOf()

### æ ¸å¿ƒåŒºåˆ«

```js
const arr = [1, 2, 3, NaN];

// indexOf - æ— æ³•æ£€æµ‹ NaN
arr.indexOf(NaN);     // -1 âŒ

// includes - å¯ä»¥æ£€æµ‹ NaN
arr.includes(NaN);    // true âœ…
```

### è¯¦ç»†å¯¹æ¯”

| ç‰¹æ€§ | `indexOf()` | `includes()` |
|------|------------|-------------|
| è¿”å›å€¼ | ç´¢å¼•æˆ– -1 | `true` / `false` |
| NaN æ£€æµ‹ | âŒ æ— æ³•æ£€æµ‹ | âœ… å¯ä»¥æ£€æµ‹ |
| è¯­ä¹‰åŒ– | ä¸å¤Ÿç›´è§‚ | æ›´æ¸…æ™° |
| å…¼å®¹æ€§ | ES5 | ES7 (ES2016) |

### ä½¿ç”¨ç¤ºä¾‹

```js
const arr = [1, 2, 3, NaN, undefined];

// indexOf
arr.indexOf(2);        // 1
arr.indexOf(5);        // -1
arr.indexOf(NaN);      // -1 âŒ
arr.indexOf(undefined); // 4

// includes
arr.includes(2);       // true
arr.includes(5);       // false
arr.includes(NaN);     // true âœ…
arr.includes(undefined); // true

// è¯­ä¹‰åŒ–å¯¹æ¯”
// âŒ ä¸å¤Ÿç›´è§‚
if (arr.indexOf(2) !== -1) {
  console.log('æ‰¾åˆ°äº†');
}

// âœ… æ›´æ¸…æ™°
if (arr.includes(2)) {
  console.log('æ‰¾åˆ°äº†');
}
```

### ğŸ’¡ ä½¿ç”¨å»ºè®®

- **åªéœ€åˆ¤æ–­å­˜åœ¨æ€§**ï¼šä½¿ç”¨ `includes()`
- **éœ€è¦è·å–ç´¢å¼•**ï¼šä½¿ç”¨ `indexOf()` æˆ– `findIndex()`

## 26. ç§»åŠ¨ç«¯ä¸‹æ‹‰åˆ·æ–°ä¸ä¸Šæ‹‰åŠ è½½

### ä¸Šæ‹‰åŠ è½½ï¼ˆè§¦åº•åŠ è½½ï¼‰

#### å…³é”®å±æ€§

```js
// å…ƒç´ é«˜åº¦å±æ€§
element.clientHeight;   // å¯è§åŒºåŸŸé«˜åº¦ï¼ˆä¸å«è¾¹æ¡†ï¼‰
element.offsetHeight;   // å¯è§åŒºåŸŸé«˜åº¦ï¼ˆå«è¾¹æ¡†ï¼‰
element.scrollHeight;   // å†…å®¹æ€»é«˜åº¦ï¼ˆå«æ»šåŠ¨éƒ¨åˆ†ï¼‰
element.scrollTop;      // å·²æ»šåŠ¨çš„é«˜åº¦
```

#### è§¦åº•åˆ¤æ–­

```js
// è§¦åº•æ¡ä»¶
scrollTop + clientHeight >= scrollHeight;

// å®ç°ç¤ºä¾‹
window.addEventListener('scroll', () => {
  const { scrollTop, clientHeight, scrollHeight } = document.documentElement;

  // è·ç¦»åº•éƒ¨ 50px æ—¶è§¦å‘
  if (scrollTop + clientHeight >= scrollHeight - 50) {
    loadMore();
  }
});

function loadMore() {
  console.log('åŠ è½½æ›´å¤šæ•°æ®...');
  // å‘é€è¯·æ±‚è·å–æ›´å¤šæ•°æ®
}
```

### ä¸‹æ‹‰åˆ·æ–°

#### å®ç°æ­¥éª¤

1. **touchstart**ï¼šè®°å½•åˆå§‹è§¦æ‘¸ä½ç½®
2. **touchmove**ï¼šè®¡ç®—ä¸‹æ‹‰è·ç¦»ï¼Œæ˜¾ç¤ºåˆ·æ–°æç¤º
3. **touchend**ï¼šåˆ¤æ–­æ˜¯å¦è¾¾åˆ°åˆ·æ–°é˜ˆå€¼ï¼Œæ‰§è¡Œåˆ·æ–°

#### å®ç°ç¤ºä¾‹

```js
let startY = 0;
let isPulling = false;

const container = document.querySelector('.container');

// 1. è®°å½•åˆå§‹ä½ç½®
container.addEventListener('touchstart', (e) => {
  // åªåœ¨é¡¶éƒ¨æ—¶å…è®¸ä¸‹æ‹‰
  if (container.scrollTop === 0) {
    startY = e.touches[0].pageY;
    isPulling = true;
  }
});

// 2. è®¡ç®—ä¸‹æ‹‰è·ç¦»
container.addEventListener('touchmove', (e) => {
  if (!isPulling) return;

  const currentY = e.touches[0].pageY;
  const distance = currentY - startY;

  // åªå¤„ç†å‘ä¸‹æ‹‰
  if (distance > 0) {
    e.preventDefault();  // é˜»æ­¢é»˜è®¤æ»šåŠ¨

    // ä½¿ç”¨ transform ç§»åŠ¨å…ƒç´ 
    container.style.transform = `translateY(${distance}px)`;

    // æ˜¾ç¤ºåˆ·æ–°æç¤º
    if (distance > 80) {
      showRefreshHint('é‡Šæ”¾åˆ·æ–°');
    } else {
      showRefreshHint('ä¸‹æ‹‰åˆ·æ–°');
    }
  }
});

// 3. åˆ¤æ–­æ˜¯å¦åˆ·æ–°
container.addEventListener('touchend', (e) => {
  if (!isPulling) return;

  const currentY = e.changedTouches[0].pageY;
  const distance = currentY - startY;

  // è¾¾åˆ°é˜ˆå€¼ï¼Œæ‰§è¡Œåˆ·æ–°
  if (distance > 80) {
    refresh();
  }

  // é‡ç½®çŠ¶æ€
  container.style.transform = 'translateY(0)';
  isPulling = false;
  hideRefreshHint();
});

function refresh() {
  console.log('åˆ·æ–°æ•°æ®...');
  // å‘é€è¯·æ±‚åˆ·æ–°æ•°æ®
}
```

### ğŸ’¡ ç°ä»£æ–¹æ¡ˆ

```js
// ä½¿ç”¨ Intersection Observer API å®ç°ä¸Šæ‹‰åŠ è½½
const observer = new IntersectionObserver((entries) => {
  if (entries[0].isIntersecting) {
    loadMore();
  }
});

const sentinel = document.querySelector('.sentinel');
observer.observe(sentinel);

// ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“
// - better-scroll
// - pulltorefresh.js
// - react-pull-to-refresh
```

---

## æ€»ç»“

æœ¬ç¬”è®°æ¶µç›–äº† JavaScript çš„æ ¸å¿ƒåŸºç¡€çŸ¥è¯†ï¼ŒåŒ…æ‹¬ï¼š

- âœ… æ•°æ®ç±»å‹ä¸ç±»å‹æ£€æµ‹
- âœ… ç±»å‹è½¬æ¢è§„åˆ™ä¸æ˜“é”™ç‚¹
- âœ… this æŒ‡å‘ä¸ç»‘å®šä¼˜å…ˆçº§
- âœ… å¸¸ç”¨ API å¯¹æ¯”ä¸æœ€ä½³å®è·µ
- âœ… ä¸¥æ ¼æ¨¡å¼ä¸å°¾è°ƒç”¨ä¼˜åŒ–
- âœ… ç§»åŠ¨ç«¯äº¤äº’å®ç°

**å­¦ä¹ å»ºè®®**ï¼šé‡ç‚¹å…³æ³¨æ ‡è®° âš ï¸ å’Œ ğŸ’¡ çš„å†…å®¹ï¼Œè¿™äº›æ˜¯æ˜“é”™ç‚¹å’Œæœ€ä½³å®è·µã€‚
